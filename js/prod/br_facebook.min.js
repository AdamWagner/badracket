function bullshit(){$("html").html("");br_facebook.BR.photos=_.sortBy(br_facebook.BR.photos,function(p){return-p.likes});console.log(br_facebook.BR.photos);_.each(br_facebook.BR.photos,function(el){$("html").append('<img style="width:100%;" src="'+el.src+'"/>')})}function setupFacebook(){br_facebook.init();br_facebook.UI.bindUI.login()}var br_facebook=function(){function populateUser(userID){FB.api("/"+userID,function(data){user.first_name=data.first_name;user.last_name=data.last_name;user.email=data.email;UI.render.user();_.each(logic.callstack,function(el){el()})});FB.api("/"+userID+"/picture",function(data){user.picture=data.data.url;UI.render.userPicture()});FB.api("/"+userID+"/likes",function(data){user.likes=data.data;_.each(user.likes,function(el){if(el.name===BR.pageName){user.likesBR=true}})})}function init(){FB.init({appId:"182655285084916",channelUrl:"//WWW.BADRACKET.COM/channel.html",status:true,cookie:true,xfbml:true});FB.getLoginStatus(function(response){if(response.status==="connected"){var r=response.authResponse;logic.globalSetup(r);UI.render.authStatus("logged-in")}else{UI.render.authStatus("logged-out")}})}var user={token:null,userID:null,first_name:null,last_name:null,email:null,likesBR:null,eventsAttending:[],bandLikes:[],musicListens:[]};var BR={id:null,pageName:null,link:null,likes:null,events:[],photos:[]};var logic=function(){function globalSetup(r){user.userID=r.userID;user.token=r.accessToken;populateUser(user.userID);populateBR.getBaseline();populateBR.getEvents()}function login(){FB.login(function(response){if(response.authResponse){fbToken=response.authResponse.accessToken;br_facebook.token=fbToken;var r=response.authResponse;globalSetup(r);UI.render.authStatus("logged-in")}else{UI.render.authStatus("logged-out")}},{scope:permissions})}var callstack=[];var permissions="email,user_activities,friends_activities,user_likes,friends_likes,friends_location,rsvp_event,user_events";return{callstack:callstack,globalSetup:globalSetup,login:login}}();var populateBR=function(){function getBaseline(){FB.api("/badracket",function(data){BR.pageName=data.name;BR.id=data.id;BR.likes=data.likes;BR.link=data.link})}function getEvents(){FB.api("/badracket/events",function(data){BR.events=data.data})}function getPhotos(){var albums;FB.api("/badracket/albums?fields=id&limit=9999",function(data){albums=data.data;getPhotoURLS(albums)})}function getPhotoURLS(albums){_.each(albums,function(el){FB.api(el.id+"/photos?limit=9999",function(data){var allPhotos=data.data;_.each(allPhotos,function(el){var src=el.images[0].source;var likes=el.likes?el.likes.data.length:0;BR.photos.push({src:src,likes:likes})})})})}return{getBaseline:getBaseline,getEvents:getEvents,getPhotos:getPhotos}}();var UI=function(){function viewDelegate(){var view=br_state.viewGet();if(view==="show-detail"){var eventID=$(".show-rsvp").data("fb-id");render.rsvpButton(eventID)}}var handlers={login:function(){console.log("login handler ran");logic.login()}};var render={authStatus:function(status){console.log("auth status ran");var html=$("html");if(status==="logged-in"){html.addClass("fb-logged-in");html.removeClass("fb-logged-out")}else{html.addClass("fb-logged-out");html.removeClass("fb-logged-in")}},user:function(){console.log("render login ran");var greeting=["Welcome ","Howdy ","Hola "];var random=Math.floor(Math.random()*greeting.length);$(".fb-user-name").text(greeting[random]+user.first_name+"!")},userPicture:function(){$(".fb-user-picture").attr("src",user.picture)},rsvpButton:function(eventID){console.log("render rsvp button ran");console.log(eventID)}};var bindUI={login:function(){$(".facebook .login").on("click",handlers.login)}};return{handers:handlers,viewDelegate:viewDelegate,bindUI:bindUI,render:render}}();return{init:init,user:user,BR:BR,UI:UI,populateBR:populateBR,populateUser:populateUser,logic:logic}}();