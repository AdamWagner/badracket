var s,badracket;window.enquire=function(matchMedia){"use strict";function each(collection,fn){var cont,i=0,length=collection.length;for(i;i<length;i++){cont=fn(collection[i],i);if(cont===false){break}}}function isArray(target){return Object.prototype.toString.apply(target)==="[object Array]"}function isFunction(target){return typeof target==="function"}function QueryHandler(options){this.initialised=false;this.options=options;if(!options.deferSetup){this.setup()}}function MediaQuery(query,isUnconditional){this.query=query;this.isUnconditional=isUnconditional;this.handlers=[];this.matched=false}function MediaQueryDispatch(){var capabilityTest;if(!matchMedia){throw new Error("matchMedia is required")}capabilityTest=new MediaQuery("only all");this.queries={};this.listening=false;this.browserIsIncapable=!capabilityTest.matchMedia()}QueryHandler.prototype={setup:function(e){if(this.options.setup){this.options.setup(e)}this.initialised=true},on:function(e){if(!this.initialised){this.setup(e)}this.options.match(e)},off:function(e){if(this.options.unmatch){this.options.unmatch(e)}},destroy:function(){if(this.options.destroy){this.options.destroy()}else{this.off()}},equals:function(target){return this.options===target||this.options.match===target}};MediaQuery.prototype={matchMedia:function(){return matchMedia(this.query).matches},addHandler:function(handler,turnOn){var qh=new QueryHandler(handler);this.handlers.push(qh);turnOn&&this.matched&&qh.on()},removeHandler:function(handler){var handlers=this.handlers;each(handlers,function(h,i){if(h.equals(handler)){h.destroy();return!handlers.splice(i,1)}})},assess:function(e){if(this.matchMedia()||this.isUnconditional){this.match(e)}else{this.unmatch(e)}},match:function(e){if(this.matched){return}each(this.handlers,function(handler){handler.on(e)});this.matched=true},unmatch:function(e){if(!this.matched){return}each(this.handlers,function(handler){handler.off(e)});this.matched=false}};MediaQueryDispatch.prototype={register:function(q,options,shouldDegrade){var queries=this.queries,isUnconditional=shouldDegrade&&this.browserIsIncapable,listening=this.listening;if(!queries.hasOwnProperty(q)){queries[q]=new MediaQuery(q,isUnconditional);this.listening&&queries[q].assess()}if(isFunction(options)){options={match:options}}if(!isArray(options)){options=[options]}each(options,function(handler){queries[q].addHandler(handler,listening)});return this},unregister:function(q,handler){var queries=this.queries;if(!queries.hasOwnProperty(q)){return this}if(!handler){each(this.queries[q].handlers,function(handler){handler.destroy()});delete queries[q]}else{queries[q].removeHandler(handler)}return this},fire:function(e){var mediaQuery,queries=this.queries;for(mediaQuery in queries){if(queries.hasOwnProperty(mediaQuery)){queries[mediaQuery].assess(e)}}return this},listen:function(timeout){function wireFire(event){var timer;window.addEventListener(event,function(e){timer&&clearTimeout(timer);timer=setTimeout(function(){self.fire(e)},timeout)},false)}var self=this;timeout=timeout||500;if(this.listening){return this}if(window.addEventListener){wireFire("resize");wireFire("orientationChange")}self.fire();this.listening=true;return this}};return new MediaQueryDispatch}(window.matchMedia);badracket={settings:{bd:$("body"),playBar:$(".controls .position"),playSlider:$("#slider"),audioPlayer:$(".audio-player")},init:function(){s=this.settings;this.docReady();this.load();this.djaxLoad()},enquire:function(){enquire.register("screen and (max-width : 1024px)",badracket.setupMobile()).listen()},setupMobile:function(){return{setup:function(){badracket.loader.require(["js/lib/jquery.tap.js"],function(){badracket.bindMobileUI()})},deferSetup:true,match:function(){},unmatch:function(){}}},setup:function(){badracket.loader.require(["js/lib/soundmanager2.js","js/lib/jquery-ui-1.9.2.custom.js","js/badracket.audio-player.js","js/lib/jquery.fitvids.js"],function(){console.log("All Scripts Loaded");$(".video").fitVids();badracket.soundmanager.smSetup();if(badracket.hasCookie("sm_currentURL")){badracket.resumePlayback()}});badracket.beforeUnload()},loader:{require:function(scripts,callback){this.loadCount=0;this.totalRequired=scripts.length;this.callback=callback;for(var i=0;i<scripts.length;i++){this.writeScript(scripts[i])}},loaded:function(evt){this.loadCount++;if(this.loadCount==this.totalRequired&&typeof this.callback=="function")this.callback.call()},writeScript:function(src){var self=this;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=src;s.addEventListener("load",function(e){self.loaded(e)},false);var head=document.getElementsByTagName("head")[0];head.appendChild(s)}},setCookie:function(key,value,days){var expires;if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=key+"="+value+expires+"; path=/"},getCookie:function(sKey){if(!sKey||!badracket.hasCookie(sKey)){return null}return unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},removeCookie:function(key){document.cookie=encodeURIComponent(key)+"=deleted; expires="+(new Date(0)).toUTCString()+"; path=/"},hasCookie:function(sKey){return(new RegExp("(?:^|;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)},docReady:function(){$(document).ready(function(){badracket.enquire();console.log("document ready fires")})},load:function(){$(window).load(function(){badracket.setup();badracket.lazyLoadImg();getShit()})},djaxLoad:function(){$(window).bind("djaxLoad",function(e,data){badracket.lazyLoadImg();badracket.soundmanager.djaxInit();$(".main-content").removeClass("loading");getShit()});$(window).bind("djaxClick",function(e,data){$(".main-content").addClass("loading")})},lazyLoadImg:function(){$(".lazyload").each(function(){console.log("lazyload ran");var lazy=$(this);var src=lazy.attr("data-src");$("<img>").attr("src",src).load(function(){lazy.css("background-image",'url("'+src+'")');if(lazy.hasClass("fade")){lazy.parent().addClass("loaded")}else if(lazy.hasClass("fade-this")){lazy.addClass("loaded")}})})},beforeUnload:function(){window.onbeforeunload=function(){badracket.removeCookie("sm_lastPosition");badracket.removeCookie("sm_paused");badracket.setCookie("sm_stopped");badracket.removeCookie("sm_currentURL");badracket.removeCookie("sm_duration");badracket.removeCookie("songTitle");badracket.removeCookie("artistName")}},bindMobileUI:function(){$(".menu").on("tap",function(){badracket.updatePageState("nav-state")});$('nav[role="navigation"] a').on("tap",function(){s.bd.attr("data-state","default-state")});$(".info").on("tap",function(){badracket.updatePageState("info-state")});$(document).bind("pageinit",function(event){$.event.special.swipe.verticalDistanceThreshold=40;$.event.special.swipe.horizontalDistanceThreshold=160;$.event.special.swipe.durationThreshold=300;$("body").bind("swipeleft",function(){badracket.updatePageState("info-state")});$("body").bind("swiperight",function(){badracket.updatePageState("nav-state")})})},updatePageState:function(pageState){if(s.bd.attr("data-state")==="default-state"){s.bd.attr("data-state",pageState)}else{s.bd.attr("data-state","default-state")}}};badracket.init();