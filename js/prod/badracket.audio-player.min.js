function updateView(){return function(_,url){br_state.viewSet(url)}}function doMoreStuff(){var album,song;console.log("do more stuff ran");album=br_player.history.album.random();song=br_player.albumData.sampleSong(album);br_player.history.update(album,song);br_player.ui.render.init(album,song);br_player.ui.bindui.album();br_player.ui.bindui.song();br_player.ui.bindui.slider();br_player.ui.bindui.play();br_player.ui.bindui.next();br_player.ui.bindui.buyAlbum();br_player.ui.bindui.buyAlbumHover();br_player.ui.bindui.previous()}var br_sm2,br_inline_player,br_player,init;(function($,undefined){function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false}img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden"}).length}var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};if($.ui.version){return}$.extend($.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem)}},delay)}):this._focus.apply(this,arguments)},scrollParent:function(){var scrollParent;if($.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))){scrollParent=this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}else{scrollParent=this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}return/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){var elem,position,value;if(zIndex!==undefined){return this.css("zIndex",zIndex)}if(this.length){elem=$(this[0]);while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value}}elem=elem.parent()}}return 0},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++uuid}})},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id")}})}});$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));div.offsetHeight;$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart"in div;body.removeChild(div).style.display="none"});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0}});return size}var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this)}return this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size)}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px")})}})}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key))}else{return removeData.call(this)}}}($.fn.removeData)}(function(){var uaMatch=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];$.ui.ie=uaMatch.length?true:false;$.ui.ie6=parseFloat(uaMatch[1],10)===6})();$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args)}}}},contains:$.contains,hasScroll:function(el,a){var scroll,has;if($(el).css("overflow")==="hidden"){return false}scroll=a&&a==="left"?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true}el[scroll]=1;has=el[scroll]>0;el[scroll]=0;return has},isOverAxis:function(x,reference,size){return x>reference&&x<reference+size},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width)}})})(jQuery);(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){var i,elem;for(i=0;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove")}catch(e){}}_cleanData(elems)};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element)}if(arguments.length){this._createWidget(options,element)}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if($.isFunction(value)){prototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var returnValue,__super=this._super,__superApply=this._superApply;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()}});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix:name},prototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetBaseClass:fullName,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else{base._childConstructors.push(constructor)}$.widget.bridge(name,constructor)};$.widget.extend=function(target){var key,value,input=slice.call(arguments,1),inputIndex=0,inputLength=input.length;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value)}else{target[key]=value}}}}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance")}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false}})}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init()}else{$.data(this,fullName,new object(options,this))}})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetName,this);$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy()}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(arguments.length===0){return $.widget.extend({},this.options)}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(value===undefined){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(value===undefined){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element)}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var match,eventName,selector;if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++}match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy)}else{element.bind(eventName,handlerProxy)}})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var instance;instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){var hasOptions,effectName;if(typeof options==="string"){options={effect:options}}effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options}}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay)}if(hasOptions&&$.effects&&($.effects.effect[effectName]||$.uiBackCompat!==false&&$.effects[effectName])){element[method](options)}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback)}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0])}next()})}}});if($.uiBackCompat!==false){$.Widget.prototype._getCreateOptions=function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]}}})(jQuery);(function($){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false});$.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(event){var that,btnIsLeft,elIsCancel;if(mouseHandled){return}this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;that=this,btnIsLeft=event.which===1,elIsCancel=typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==false;if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function(event){if($.ui.ie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event)}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==false;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}return false},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);(function($){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var i,handleCount,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()]}if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]]}}this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+(o.range==="min"||o.range==="max"?" ui-slider-range-"+o.range:""))}handleCount=o.values&&o.values.length||1;for(i=existingHandles.length;i<handleCount;i++){handles.push(handle)}this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault()}).mouseenter(function(){if(!o.disabled){$(this).addClass("ui-state-hover")}}).mouseleave(function(){$(this).removeClass("ui-state-hover")}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus")}else{$(this).blur()}}).blur(function(){$(this).removeClass("ui-state-focus")});this.handles.each(function(i){$(this).data("ui-slider-handle-index",i)});this._on(this.handles,{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;$(event.target).addClass("ui-state-active");allowed=this._start(event,index);if(allowed===false){return}}break}step=this.options.step;if(this.options.values&&this.options.values.length){curVal=newVal=this.values(index)}else{curVal=newVal=this.value()}switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+(this._valueMax()-this._valueMin())/numPages);break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-(this._valueMax()-this._valueMin())/numPages);break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return}newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return}newVal=this._trimAlignValue(curVal-step);break}this._slide(event,index,newVal)},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);$(event.target).removeClass("ui-state-active")}}});this._refreshValue();this._animateOff=false},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy()},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index])}allowed=this._start(event,index);if(allowed===false){return false}this._mouseSliding=true;this._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-closestHandle.width()/2,top:event.pageY-offset.top-closestHandle.height()/2-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue)}this._animateOff=true;return true},_mouseStart:function(){return true},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}percentMouse=pixelMouse/pixelTotal;if(percentMouse>1){percentMouse=1}if(percentMouse<0){percentMouse=0}if(this.orientation==="vertical"){percentMouse=1-percentMouse}valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse)},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}return this._trigger("start",event,uiHash)},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if(this.options.values.length===2&&this.options.range===true&&(index===0&&newVal>otherVal||index===1&&newVal<otherVal)){newVal=otherVal}if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true)}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal)}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}this._trigger("stop",event,uiHash)},_change:function(event,index){var uiHash;if(!this._keySliding&&!this._mouseSliding){uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}this._trigger("change",event,uiHash)}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return}return this._value()},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return}if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i)}this._refreshValue()}else{if(this.options.values&&this.options.values.length){return this._values(index)}else{return this.value()}}}else{return this._values()}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length}$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.prop("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.prop("disabled",false);this.element.removeClass("ui-disabled")}break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i)}this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i])}return vals}},_trimAlignValue:function(val){var step,valModStep,alignValue;if(val<=this._valueMin()){return this._valueMin()}if(val>=this._valueMax()){return this._valueMax()}step=this.options.step>0?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=valModStep>0?step:-step}return parseFloat(alignValue.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=!this._animateOff?o.animate:false,_set={};if(this.options.values&&this.options.values.length){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate)}if(i===1){that.range[animate?"animate":"css"]({width:valPercent-lastValPercent+"%"},{queue:false,duration:o.animate})}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:valPercent+"%"},o.animate)}if(i===1){that.range[animate?"animate":"css"]({height:valPercent-lastValPercent+"%"},{queue:false,duration:o.animate})}}}lastValPercent=valPercent})}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=valueMax!==valueMin?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate)}if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:100-valPercent+"%"},{queue:false,duration:o.animate})}if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate)}if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:100-valPercent+"%"},{queue:false,duration:o.animate})}}}})})(jQuery);(function(window,_undefined){"use strict";function SoundManager(smURL,smID){function preferFlashCheck(kind){return sm2.preferFlash&&hasFlash&&!sm2.ignoreFlash&&sm2.flash[kind]!==_undefined&&sm2.flash[kind]}function html5_event(oFn){return function(e){var result,s=this._s;if(!s||!s._a){if(s&&s.id){sm2._wD(s.id+": Ignoring "+e.type)}else{sm2._wD(h5+"Ignoring "+e.type)}result=null}else{result=oFn.call(this,e)}return result}}var SMSound,sm2,globalHTML5Audio,flash,sm,smc,h5,id,ua,wl,doc,doNothing,setProperties,init,fV,on_queue,debugOpen,debugTS,didAppend,appendSuccess,didInit,disabled,windowLoaded,_wDS,wdCount,initComplete,mixin,assign,extraOptions,addOnEvent,processOnEvents,initUserOnload,delayWaitForEI,waitForEI,setVersionInfo,handleFocus,strings,initMovie,preInit,domContentLoaded,winOnLoad,didDCLoaded,getDocument,createMovie,catchError,setPolling,initDebug,debugLevels,defaultFlashVersion,disableObject,failSafely,normalizeMovieURL,oRemoved,oRemovedHTML,str,flashBlockHandler,getSWFCSS,swfCSS,toggleDebug,loopFix,policyFix,complain,idCheck,waitingForEI,initPending,startTimer,stopTimer,timerExecute,h5TimerCount,h5IntervalTimer,parseURL,messages,needsFlash,featureCheck,html5OK,html5CanPlay,html5Ext,html5Unload,domContentLoadedIE,testHTML5,event,slice,useGlobalHTML5Audio,lastGlobalHTML5URL,hasFlash,detectFlash,badSafariFix,html5_events,showSupport,flushMessages,is_iDevice,isAndroid,isIE,isWebkit,isSafari,isOpera,mobileHTML5,isBadSafari,hasConsole,isFocused,tryInitOnFocus,okToDisable,flashMIME,emptyURL,overHTTP,http,netStreamMimeTypes,netStreamTypes,netStreamPattern;this.setupOptions={url:smURL||null,flashVersion:8,debugMode:true,debugFlash:false,useConsole:true,consoleOnly:true,waitForWindowLoad:false,bgColor:"#ffffff",useHighPerformance:false,flashPollingInterval
:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:false,useHTML5Audio:true,html5Test:/^(probably|maybe)$/i,preferFlash:true,noSWFCache:false};this.defaultOptions={autoLoad:false,autoPlay:false,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:true,multiShotEvents:false,position:null,pan:0,stream:true,to:null,type:null,usePolicyFile:false,volume:100};this.flash9Options={isMovieStar:null,usePeakData:false,useWaveformData:false,useEQData:false,onbufferchange:null,ondataerror:null};this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null};this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:true},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:false},ogg:{type:["audio/ogg; codecs=vorbis"],required:false},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:false}};this.movieID="sm2-container";this.id=smID||"sm2movie";this.debugID="soundmanager-debug";this.debugURLParam=/([#?&])debug=1/i;this.versionNumber="V2.97a.20130101";this.version=null;this.movieURL=null;this.altURL=null;this.swfLoaded=false;this.enabled=false;this.oMC=null;this.sounds={};this.soundIDs=[];this.muted=false;this.didFlashBlock=false;this.filePattern=null;this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i};this.features={buffering:false,peakData:false,waveformData:false,eqData:false,movieStar:false};this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null};this.html5={usingFlash:null};this.flash={};this.html5Only=false;this.ignoreFlash=false;sm2=this,globalHTML5Audio=null,flash=null,sm="soundManager",smc=sm+": ",h5="HTML5::",ua=navigator.userAgent,wl=window.location.href.toString(),doc=document,on_queue=[],debugOpen=true,didAppend=false,appendSuccess=false,didInit=false,disabled=false,windowLoaded=false,wdCount=0,debugLevels=["log","info","warn","error"],defaultFlashVersion=8,oRemoved=null,oRemovedHTML=null,waitingForEI=false,initPending=false,h5TimerCount=0,h5IntervalTimer=null,messages=[],needsFlash=null,slice=Array.prototype.slice,useGlobalHTML5Audio=false,is_iDevice=ua.match(/(ipad|iphone|ipod)/i),isAndroid=ua.match(/android/i),isIE=ua.match(/msie/i),isWebkit=ua.match(/webkit/i),isSafari=ua.match(/safari/i)&&!ua.match(/chrome/i),isOpera=ua.match(/opera/i),mobileHTML5=ua.match(/(mobile|pre\/|xoom)/i)||is_iDevice||isAndroid,isBadSafari=!wl.match(/usehtml5audio/i)&&!wl.match(/sm2\-ignorebadua/i)&&isSafari&&!ua.match(/silk/i)&&ua.match(/OS X 10_6_([3-7])/i),hasConsole=window.console!==_undefined&&console.log!==_undefined,isFocused=doc.hasFocus!==_undefined?doc.hasFocus():null,tryInitOnFocus=isSafari&&(doc.hasFocus===_undefined||!doc.hasFocus()),okToDisable=!tryInitOnFocus,flashMIME=/(mp3|mp4|mpa|m4a|m4b)/i,emptyURL="about:blank",overHTTP=doc.location?doc.location.protocol.match(/http/i):null,http=!overHTTP?"http:/"+"/":"",netStreamMimeTypes=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,netStreamTypes=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],netStreamPattern=new RegExp("\\.("+netStreamTypes.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i;this.useAltURL=!overHTTP;swfCSS={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"};this.hasHTML5=function(){try{return Audio!==_undefined&&(isOpera&&opera!==_undefined&&opera.version()<10?new Audio(null):new Audio).canPlayType!==_undefined}catch(e){return false}}();this.setup=function(options){var noURL=!sm2.url;if(options!==_undefined&&didInit&&needsFlash&&sm2.ok()&&(options.flashVersion!==_undefined||options.url!==_undefined||options.html5Test!==_undefined)){complain(str("setupLate"))}assign(options);if(noURL&&didDCLoaded&&options.url!==_undefined){sm2.beginDelayedInit()}if(!didDCLoaded&&options.url!==_undefined&&doc.readyState==="complete"){setTimeout(domContentLoaded,1)}return sm2};this.ok=function(){return needsFlash?didInit&&!disabled:sm2.useHTML5Audio&&sm2.hasHTML5};this.supported=this.ok;this.getMovie=function(smID){return id(smID)||doc[smID]||window[smID]};this.createSound=function(oOptions,_url){function make(){options=loopFix(options);sm2.sounds[options.id]=new SMSound(options);sm2.soundIDs.push(options.id);return sm2.sounds[options.id]}var options,oSound=null,cs=sm+".createSound(): ",cs_string=cs+str(!didInit?"notReady":"notOK");if(!didInit||!sm2.ok()){complain(cs_string);return false}if(_url!==_undefined){oOptions={id:oOptions,url:_url}}options=mixin(oOptions);options.url=parseURL(options.url);if(options.id.toString().charAt(0).match(/^[0-9]$/)){sm2._wD(cs+str("badID",options.id),2)}sm2._wD(cs+options.id+" ("+options.url+")",1);if(idCheck(options.id,true)){sm2._wD(cs+options.id+" exists",1);return sm2.sounds[options.id]}if(html5OK(options)){oSound=make();sm2._wD(options.id+": Using HTML5");oSound._setup_html5(options)}else{if(fV>8){if(options.isMovieStar===null){options.isMovieStar=!!(options.serverURL||(options.type?options.type.match(netStreamMimeTypes):false)||options.url.match(netStreamPattern))}if(options.isMovieStar){sm2._wD(cs+"using MovieStar handling");if(options.loops>1){_wDS("noNSLoop")}}}options=policyFix(options,cs);oSound=make();if(fV===8){flash._createSound(options.id,options.loops||1,options.usePolicyFile)}else{flash._createSound(options.id,options.url,options.usePeakData,options.useWaveformData,options.useEQData,options.isMovieStar,options.isMovieStar?options.bufferTime:false,options.loops||1,options.serverURL,options.duration||null,options.autoPlay,true,options.autoLoad,options.usePolicyFile);if(!options.serverURL){oSound.connected=true;if(options.onconnect){options.onconnect.apply(oSound)}}}if(!options.serverURL&&(options.autoLoad||options.autoPlay)){oSound.load(options)}}if(!options.serverURL&&options.autoPlay){oSound.play()}return oSound};this.destroySound=function(sID,_bFromSound){var oS,i;if(!idCheck(sID)){return false}oS=sm2.sounds[sID];oS._iO={};oS.stop();oS.unload();for(i=0;i<sm2.soundIDs.length;i++){if(sm2.soundIDs[i]===sID){sm2.soundIDs.splice(i,1);break}}if(!_bFromSound){oS.destruct(true)}oS=null;delete sm2.sounds[sID];return true};this.load=function(sID,oOptions){if(!idCheck(sID)){return false}return sm2.sounds[sID].load(oOptions)};this.unload=function(sID){if(!idCheck(sID)){return false}return sm2.sounds[sID].unload()};this.onPosition=function(sID,nPosition,oMethod,oScope){if(!idCheck(sID)){return false}return sm2.sounds[sID].onposition(nPosition,oMethod,oScope)};this.onposition=this.onPosition;this.clearOnPosition=function(sID,nPosition,oMethod){if(!idCheck(sID)){return false}return sm2.sounds[sID].clearOnPosition(nPosition,oMethod)};this.play=function(sID,oOptions){var result=false;if(!didInit||!sm2.ok()){complain(sm+".play(): "+str(!didInit?"notReady":"notOK"));return result}if(!idCheck(sID)){if(!(oOptions instanceof Object)){oOptions={url:oOptions}}if(oOptions&&oOptions.url){sm2._wD(sm+'.play(): attempting to create "'+sID+'"',1);oOptions.id=sID;result=sm2.createSound(oOptions).play()}return result}return sm2.sounds[sID].play(oOptions)};this.start=this.play;this.setPosition=function(sID,nMsecOffset){if(!idCheck(sID)){return false}return sm2.sounds[sID].setPosition(nMsecOffset)};this.stop=function(sID){if(!idCheck(sID)){return false}sm2._wD(sm+".stop("+sID+")",1);return sm2.sounds[sID].stop()};this.stopAll=function(){var oSound;sm2._wD(sm+".stopAll()",1);for(oSound in sm2.sounds){if(sm2.sounds.hasOwnProperty(oSound)){sm2.sounds[oSound].stop()}}};this.pause=function(sID){if(!idCheck(sID)){return false}return sm2.sounds[sID].pause()};this.pauseAll=function(){var i;for(i=sm2.soundIDs.length-1;i>=0;i--){sm2.sounds[sm2.soundIDs[i]].pause()}};this.resume=function(sID){if(!idCheck(sID)){return false}return sm2.sounds[sID].resume()};this.resumeAll=function(){var i;for(i=sm2.soundIDs.length-1;i>=0;i--){sm2.sounds[sm2.soundIDs[i]].resume()}};this.togglePause=function(sID){if(!idCheck(sID)){return false}return sm2.sounds[sID].togglePause()};this.setPan=function(sID,nPan){if(!idCheck(sID)){return false}return sm2.sounds[sID].setPan(nPan)};this.setVolume=function(sID,nVol){if(!idCheck(sID)){return false}return sm2.sounds[sID].setVolume(nVol)};this.mute=function(sID){var i=0;if(sID instanceof String){sID=null}if(!sID){sm2._wD(sm+".mute(): Muting all sounds");for(i=sm2.soundIDs.length-1;i>=0;i--){sm2.sounds[sm2.soundIDs[i]].mute()}sm2.muted=true}else{if(!idCheck(sID)){return false}sm2._wD(sm+'.mute(): Muting "'+sID+'"');return sm2.sounds[sID].mute()}return true};this.muteAll=function(){sm2.mute()};this.unmute=function(sID){var i;if(sID instanceof String){sID=null}if(!sID){sm2._wD(sm+".unmute(): Unmuting all sounds");for(i=sm2.soundIDs.length-1;i>=0;i--){sm2.sounds[sm2.soundIDs[i]].unmute()}sm2.muted=false}else{if(!idCheck(sID)){return false}sm2._wD(sm+'.unmute(): Unmuting "'+sID+'"');return sm2.sounds[sID].unmute()}return true};this.unmuteAll=function(){sm2.unmute()};this.toggleMute=function(sID){if(!idCheck(sID)){return false}return sm2.sounds[sID].toggleMute()};this.getMemoryUse=function(){var ram=0;if(flash&&fV!==8){ram=parseInt(flash._getMemoryUse(),10)}return ram};this.disable=function(bNoDisable){var i;if(bNoDisable===_undefined){bNoDisable=false}if(disabled){return false}disabled=true;_wDS("shutdown",1);for(i=sm2.soundIDs.length-1;i>=0;i--){disableObject(sm2.sounds[sm2.soundIDs[i]])}initComplete(bNoDisable);event.remove(window,"load",initUserOnload);return true};this.canPlayMIME=function(sMIME){var result;if(sm2.hasHTML5){result=html5CanPlay({type:sMIME})}if(!result&&needsFlash){result=sMIME&&sm2.ok()?!!((fV>8?sMIME.match(netStreamMimeTypes):null)||sMIME.match(sm2.mimePattern)):null}return result};this.canPlayURL=function(sURL){var result;if(sm2.hasHTML5){result=html5CanPlay({url:sURL})}if(!result&&needsFlash){result=sURL&&sm2.ok()?!!sURL.match(sm2.filePattern):null}return result};this.canPlayLink=function(oLink){if(oLink.type!==_undefined&&oLink.type){if(sm2.canPlayMIME(oLink.type)){return true}}return sm2.canPlayURL(oLink.href)};this.getSoundById=function(sID,_suppressDebug){var result;if(!sID){throw new Error(sm+".getSoundById(): sID is null/_undefined")}result=sm2.sounds[sID];if(!result&&!_suppressDebug){sm2._wD('"'+sID+'" is an invalid sound ID.',2)}return result};this.onready=function(oMethod,oScope){var sType="onready",result=false;if(typeof oMethod==="function"){if(didInit){sm2._wD(str("queue",sType))}if(!oScope){oScope=window}addOnEvent(sType,oMethod,oScope);processOnEvents();result=true}else{throw str("needFunction",sType)}return result};this.ontimeout=function(oMethod,oScope){var sType="ontimeout",result=false;if(typeof oMethod==="function"){if(didInit){sm2._wD(str("queue",sType))}if(!oScope){oScope=window}addOnEvent(sType,oMethod,oScope);processOnEvents({type:sType});result=true}else{throw str("needFunction",sType)}return result};this._writeDebug=function(sText,sType){var o,oItem,sDID="soundmanager-debug";if(!sm2.debugMode){return false}if(hasConsole&&sm2.useConsole){if(sType&&typeof sType==="object"){console.log(sText,sType)}else if(debugLevels[sType]!==_undefined){console[debugLevels[sType]](sText)}else{console.log(sText)}if(sm2.consoleOnly){return true}}o=id(sDID);if(!o){return false}oItem=doc.createElement("div");if(++wdCount%2===0){oItem.className="sm2-alt"}if(sType===_undefined){sType=0}else{sType=parseInt(sType,10)}oItem.appendChild(doc.createTextNode(sText));if(sType){if(sType>=2){oItem.style.fontWeight="bold"}if(sType===3){oItem.style.color="#ff3333"}}o.insertBefore(oItem,o.firstChild);o=null;return true};if(wl.indexOf("sm2-debug=alert")!==-1){this._writeDebug=function(sText){window.alert(sText)}}this._wD=this._writeDebug;this._debug=function(){var i,j;_wDS("currentObj",1);for(i=0,j=sm2.soundIDs.length;i<j;i++){sm2.sounds[sm2.soundIDs[i]]._debug()}};this.reboot=function(resetEvents,excludeInit){var i,j,k;if(sm2.soundIDs.length){sm2._wD("Destroying "+sm2.soundIDs.length+" SMSound objects...")}for(i=sm2.soundIDs.length-1;i>=0;i--){sm2.sounds[sm2.soundIDs[i]].destruct()}if(flash){try{if(isIE){oRemovedHTML=flash.innerHTML}oRemoved=flash.parentNode.removeChild(flash);_wDS("flRemoved")}catch(e){_wDS("badRemove",2)}}oRemovedHTML=oRemoved=needsFlash=flash=null;sm2.enabled=didDCLoaded=didInit=waitingForEI=initPending=didAppend=appendSuccess=disabled=useGlobalHTML5Audio=sm2.swfLoaded=false;sm2.soundIDs=[];sm2.sounds={};if(!resetEvents){for(i in on_queue){if(on_queue.hasOwnProperty(i)){for(j=0,k=on_queue[i].length;j<k;j++){on_queue[i][j].fired=false}}}}else{on_queue=[]}if(!excludeInit){sm2._wD(sm+": Rebooting...")}sm2.html5={usingFlash:null};sm2.flash={};sm2.html5Only=false;sm2.ignoreFlash=false;window.setTimeout(function(){preInit();if(!excludeInit){sm2.beginDelayedInit()}},20);return sm2};this.reset=function(){_wDS("reset");return sm2.reboot(true,true)};this.getMoviePercent=function(){return flash&&"PercentLoaded"in flash?flash.PercentLoaded():null};this.beginDelayedInit=function(){windowLoaded=true;domContentLoaded();setTimeout(function(){if(initPending){return false}createMovie();initMovie();initPending=true;return true},20);delayWaitForEI()};this.destruct=function(){sm2._wD(sm+".destruct()");sm2.disable(true)};SMSound=function(oOptions){var resetProperties,add_html5_events,remove_html5_events,stop_html5_timer,start_html5_timer,attachOnPosition,detachOnPosition,applyFromTo,s=this,onplay_called=false,onPositionItems=[],onPositionFired=0,lastURL=null,lastHTML5State={duration:null,time:null};this.id=oOptions.id;this.sID=this.id;this.url=oOptions.url;this.options=mixin(oOptions);this.instanceOptions=this.options;this._iO=this.instanceOptions;this.pan=this.options.pan;this.volume=this.options.volume;this.isHTML5=false;this._a=null;this.id3={};this._debug=function(){sm2._wD(s.id+": Merged options:",s.options)};this.load=function(oOptions){var instanceOptions,oSound=null;if(oOptions!==_undefined){s._iO=mixin(oOptions,s.options)}else{oOptions=s.options;s._iO=oOptions;if(lastURL&&lastURL!==s.url){_wDS("manURL");s._iO.url=s.url;s.url=null}}if(!s._iO.url){s._iO.url=s.url}s._iO.url=parseURL(s._iO.url);s.instanceOptions=s._iO;instanceOptions=s._iO;sm2._wD(s.id+": load ("+instanceOptions.url+")");if(instanceOptions.url===s.url&&s.readyState!==0&&s.readyState!==2){_wDS("onURL",1);if(s.readyState===3&&instanceOptions.onload){instanceOptions.onload.apply(s,[!!s.duration])}return s}s.loaded=false;s.readyState=1;s.playState=0;s.id3={};if(html5OK(instanceOptions)){oSound=s._setup_html5(instanceOptions);if(!oSound._called_load){s._html5_canplay=false;if(s.url!==instanceOptions.url){sm2._wD(_wDS("manURL")+": "+instanceOptions.url);s._a.src=instanceOptions.url;s.setPosition(0)}s._a.autobuffer="auto";s._a.preload="auto";s._a._called_load=true;if(instanceOptions.autoPlay){s.play()}}else{sm2._wD(s.id+": Ignoring request to load again")}}else{try{s.isHTML5=false;s._iO=policyFix(loopFix(instanceOptions));instanceOptions=s._iO;if(fV===8){flash._load(s.id,instanceOptions.url,instanceOptions.stream,instanceOptions.autoPlay,instanceOptions.usePolicyFile)}else{flash._load(s.id,instanceOptions.url,!!instanceOptions.stream,!!instanceOptions.autoPlay,instanceOptions.loops||1,!!instanceOptions.autoLoad,instanceOptions.usePolicyFile)}}catch(e){_wDS("smError",2);debugTS("onload",false);catchError({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:true})}}s.url=instanceOptions.url;return s};this.unload=function(){if(s.readyState!==0){sm2._wD(s.id+": unload()");if(!s.isHTML5){if(fV===8){flash._unload(s.id,emptyURL)}else{flash._unload(s.id)}}else{stop_html5_timer();if(s._a){s._a.pause();html5Unload(s._a,emptyURL);lastURL=emptyURL}}resetProperties()}return s};this.destruct=function(_bFromSM){sm2._wD(s.id+": Destruct");if(!s.isHTML5){s._iO.onfailure=null;flash._destroySound(s.id)}else{stop_html5_timer();if(s._a){s._a.pause();html5Unload(s._a);if(!useGlobalHTML5Audio){remove_html5_events()}s._a._s=null;s._a=null}}if(!_bFromSM){sm2.destroySound(s.id,true)}};this.play=function(oOptions,_updatePlayState){var allowMulti,a,onready,startOK=true,exit=null,fN=s.id+": play(): ";_updatePlayState=_updatePlayState===_undefined?true:_updatePlayState;if(!oOptions){oOptions={}}if(s.url){s._iO.url=s.url}s._iO=mixin(s._iO,s.options);s._iO=mixin(oOptions,s._iO);s._iO.url=parseURL(s._iO.url);s.instanceOptions=s._iO;if(s._iO.serverURL&&!s.connected){if(!s.getAutoPlay()){sm2._wD(fN+" Netstream not connected yet - setting autoPlay");s.setAutoPlay(true)}return s}if(html5OK(s._iO)){s._setup_html5(s._iO);start_html5_timer()}if(s.playState===1&&!s.paused){allowMulti=s._iO.multiShot;if(!allowMulti){sm2._wD(fN+"Already playing (one-shot)",1);exit=s}else{sm2._wD(fN+"Already playing (multi-shot)",1)}}if(exit!==null){return exit}if(oOptions.url&&oOptions.url!==s.url){s.load(s._iO)}if(!s.loaded){if(s.readyState===0){sm2._wD(fN+"Attempting to load");if(!s.isHTML5){s._iO.autoPlay=true;s.load(s._iO)}else{s.load(s._iO)}s.instanceOptions=s._iO}else if(s.readyState===2){sm2._wD(fN+"Could not load - exiting",2);exit=s}else{sm2._wD(fN+"Loading - attempting to play...")}}else{sm2._wD(fN)}if(exit!==null){return exit}if(!s.isHTML5&&fV===9&&s.position>0&&s.position===s.duration){sm2._wD(fN+"Sound at end, resetting to position:0");oOptions.position=0}if(s.paused&&s.position>=0&&(!s._iO.serverURL||s.position>0)){sm2._wD(fN+"Resuming from paused state",1);s.resume()}else{s._iO=mixin(oOptions,s._iO);if(s._iO.from!==null&&s._iO.to!==null&&s.instanceCount===0&&s.playState===0&&!s._iO.serverURL){onready=function(){s._iO=mixin(oOptions,s._iO);s.play(s._iO)};if(s.isHTML5&&!s._html5_canplay){sm2._wD(fN+"Beginning load for from/to case");s.load({oncanplay:onready});exit=false}else if(!s.isHTML5&&!s.loaded&&(!s.readyState||s.readyState!==2)){sm2._wD(fN+"Preloading for from/to case");s.load({onload:onready});exit=false}if(exit!==null){return exit}s._iO=applyFromTo()}sm2._wD(fN+"Starting to play");if(!s.instanceCount||s._iO.multiShotEvents||!s.isHTML5&&fV>8&&!s.getAutoPlay()){s.instanceCount++}if(s._iO.onposition&&s.playState===0){attachOnPosition(s)}s.playState=1;s.paused=false;s.position=s._iO.position!==_undefined&&!isNaN(s._iO.position)?s._iO.position:0;if(!s.isHTML5){s._iO=policyFix(loopFix(s._iO))}if(s._iO.onplay&&_updatePlayState){s._iO.onplay.apply(s);onplay_called=true}s.setVolume(s._iO.volume,true);s.setPan(s._iO.pan,true);if(!s.isHTML5){startOK=flash._start(s.id,s._iO.loops||1,fV===9?s._iO.position:s._iO.position/1e3,s._iO.multiShot);if(fV===9&&!startOK){sm2._wD(fN+"No sound hardware, or 32-sound ceiling hit");if(s._iO.onplayerror){s._iO.onplayerror.apply(s)}}}else{start_html5_timer();a=s._setup_html5();s.setPosition(s._iO.position);a.play()}}return s};this.start=this.play;this.stop=function(bAll){var originalPosition,instanceOptions=s._iO;if(s.playState===1){sm2._wD(s.id+": stop()");s._onbufferchange(0);s._resetOnPosition(0);s.paused=false;if(!s.isHTML5){s.playState=0}detachOnPosition();if(instanceOptions.to){s.clearOnPosition(instanceOptions.to)}if(!s.isHTML5){flash._stop(s.id,bAll);if(instanceOptions.serverURL){s.unload()}}else{if(s._a){originalPosition=s.position;s.setPosition(0);s.position=originalPosition;s._a.pause();s.playState=0;s._onTimer();stop_html5_timer()}}s.instanceCount=0;s._iO={};if(instanceOptions.onstop){instanceOptions.onstop.apply(s)}}return s};this.setAutoPlay=function(autoPlay){sm2._wD(s.id+": Autoplay turned "+(autoPlay?"on":"off"));s._iO.autoPlay=autoPlay;if(!s.isHTML5){flash._setAutoPlay(s.id,autoPlay);if(autoPlay){if(!s.instanceCount&&s.readyState===1){s.instanceCount++;sm2._wD(s.id+": Incremented instance count to "+s.instanceCount)}}}};this.getAutoPlay=function(){return s._iO.autoPlay};this.setPosition=function(nMsecOffset){var original_pos,position,position1K,offset;if(nMsecOffset===_undefined){nMsecOffset=0}offset=s.isHTML5?Math.max(nMsecOffset,0):Math.min(s.duration||s._iO.duration,Math.max(nMsecOffset,0));original_pos=s.position;s.position=offset;position1K=s.position/1e3;s._resetOnPosition(s.position);s._iO.position=offset;if(!s.isHTML5){position=fV===9?s.position:position1K;if(s.readyState&&s.readyState!==2){flash._setPosition(s.id,position,s.paused||!s.playState,s._iO.multiShot)}}else if(s._a){if(s._html5_canplay){if(s._a.currentTime!==position1K){sm2._wD(s.id+": setPosition("+position1K+")");try{s._a.currentTime=position1K;if(s.playState===0||s.paused){s._a.pause()}}catch(e){sm2._wD(s.id+": setPosition("+position1K+") failed: "+e.message,2)}}}else{sm2._wD(s.id+": setPosition("+position1K+"): Cannot seek yet, sound not ready")}}if(s.isHTML5){if(s.paused){s._onTimer(true)}}return s};this.pause=function(_bCallFlash){if(s.paused||s.playState===0&&s.readyState!==1){return s}sm2._wD(s.id+": pause()");s.paused=true;if(!s.isHTML5){if(_bCallFlash||_bCallFlash===_undefined){flash._pause(s.id,s._iO.multiShot)}}else{s._setup_html5().pause();stop_html5_timer()}if(s._iO.onpause){s._iO.onpause.apply(s)}return s};this.resume=function(){var instanceOptions=s._iO;if(!s.paused){return s}sm2._wD(s.id+": resume()");s.paused=false;s.playState=1;if(!s.isHTML5){if(instanceOptions.isMovieStar&&!instanceOptions.serverURL){s.setPosition(s.position)}flash._pause(s.id,instanceOptions.multiShot)}else{s._setup_html5().play();start_html5_timer()}if(!onplay_called&&instanceOptions.onplay){instanceOptions.onplay.apply(s);onplay_called=true}else if(instanceOptions.onresume){instanceOptions.onresume.apply(s)}return s};this.togglePause=function(){sm2._wD(s.id+": togglePause()");if(s.playState===0){s.play({position:fV===9&&!s.isHTML5?s.position:s.position/1e3});return s}if(s.paused){s.resume()}else{s.pause()}return s};this.setPan=function(nPan,bInstanceOnly){if(nPan===_undefined){nPan=0}if(bInstanceOnly===_undefined){bInstanceOnly=false}if(!s.isHTML5){flash._setPan(s.id,nPan)}s._iO.pan=nPan;if(!bInstanceOnly){s.pan=nPan;s.options.pan=nPan}return s};this.setVolume=function(nVol,_bInstanceOnly){if(nVol===_undefined){nVol=100}if(_bInstanceOnly===_undefined){_bInstanceOnly=false}if(!s.isHTML5){flash._setVolume(s.id,sm2.muted&&!s.muted||s.muted?0:nVol)}else if(s._a){s._a.volume=Math.max(0,Math.min(1,nVol/100))}s._iO.volume=nVol;if(!_bInstanceOnly){s.volume=nVol;s.options.volume=nVol}return s};this.mute=function(){s.muted=true;if(!s.isHTML5){flash._setVolume(s.id,0)}else if(s._a){s._a.muted=true}return s};this.unmute=function(){var hasIO;s.muted=false;hasIO=s._iO.volume!==_undefined;if(!s.isHTML5){flash._setVolume(s.id,hasIO?s._iO.volume:s.options.volume)}else if(s._a){s._a.muted=false}return s};this.toggleMute=function(){return s.muted?s.unmute():s.mute()};this.onPosition=function(nPosition,oMethod,oScope){onPositionItems.push({position:parseInt(nPosition,10),method:oMethod,scope:oScope!==_undefined?oScope:s,fired:false});return s};this.onposition=this.onPosition;this.clearOnPosition=function(nPosition,oMethod){var i;nPosition=parseInt(nPosition,10);if(isNaN(nPosition)){return false}for(i=0;i<onPositionItems.length;i++){if(nPosition===onPositionItems[i].position){if(!oMethod||oMethod===onPositionItems[i].method){if(onPositionItems[i].fired){onPositionFired--}onPositionItems.splice(i,1)}}}};this._processOnPosition=function(){var i,item,j=onPositionItems.length;if(!j||!s.playState||onPositionFired>=j){return false}for(i=j-1;i>=0;i--){item=onPositionItems[i];if(!item.fired&&s.position>=item.position){item.fired=true;onPositionFired++;item.method.apply(item.scope,[item.position])}}return true};this._resetOnPosition=function(nPosition){var i,item,j=onPositionItems.length;if(!j){return false}for(i=j-1;i>=0;i--){item=onPositionItems[i];if(item.fired&&nPosition<=item.position){item.fired=false;onPositionFired--}}return true};applyFromTo=function(){var instanceOptions=s._iO,f=instanceOptions.from,t=instanceOptions.to,end=function(){sm2._wD(s.id+': "To" time of '+t+" reached.");s.clearOnPosition(t,end);s.stop()},start=function(){sm2._wD(s.id+': Playing "from" '+f);if(t!==null&&!isNaN(t)){s.onPosition(t,end)}};if(f!==null&&!isNaN(f)){instanceOptions.position=f;instanceOptions.multiShot=false;start()}return instanceOptions};attachOnPosition=function(){var item,op=s._iO.onposition;if(op){for(item in op){if(op.hasOwnProperty(item)){s.onPosition(parseInt(item,10),op[item])}}}};detachOnPosition=function(){var item,op=s._iO.onposition;if(op){for(item in op){if(op.hasOwnProperty(item)){s.clearOnPosition(parseInt(item,10))}}}};start_html5_timer=function(){if(s.isHTML5){startTimer(s)}};stop_html5_timer=function(){if(s.isHTML5){stopTimer(s)}};resetProperties=function(retainPosition){if(!retainPosition){onPositionItems=[];onPositionFired=0}onplay_called=false;s._hasTimer=null;s._a=null;s._html5_canplay=false;s.bytesLoaded=null;s.bytesTotal=null;s.duration=s._iO&&s._iO.duration?s._iO.duration:null;s.durationEstimate=null;s.buffered=[];s.eqData=[];s.eqData.left=[];s.eqData.right=[];s.failures=0;s.isBuffering=false;s.instanceOptions={};s.instanceCount=0;s.loaded=false;s.metadata={};s.readyState=0;s.muted=false;s.paused=false;s.peakData={left:0,right:0};s.waveformData={left:[],right:[]};s.playState=0;s.position=null;s.id3={}};resetProperties();this._onTimer=function(bForce){var duration,time,isNew=false,x={};if(s._hasTimer||bForce){if(s._a&&(bForce||(s.playState>0||s.readyState===1)&&!s.paused)){duration=s._get_html5_duration();if(duration!==lastHTML5State.duration){lastHTML5State.duration=duration;s.duration=duration;isNew=true}s.durationEstimate=s.duration;time=s._a.currentTime*1e3||0;if(time!==lastHTML5State.time){lastHTML5State.time=time;isNew=true}if(isNew||bForce){s._whileplaying(time,x,x,x,x)}}return isNew}};this._get_html5_duration=function(){var instanceOptions=s._iO,d=s._a&&s._a.duration?s._a.duration*1e3:instanceOptions&&instanceOptions.duration?instanceOptions.duration:null,result=d&&!isNaN(d)&&d!==Infinity?d:null;return result};this._apply_loop=function(a,nLoops){if(!a.loop&&nLoops>1){sm2._wD("Note: Native HTML5 looping is infinite.",1)}a.loop=nLoops>1?"loop":""};this._setup_html5=function(oOptions){var sameURL,instanceOptions=mixin(s._iO,oOptions),d=decodeURI,a=useGlobalHTML5Audio?globalHTML5Audio:s._a,dURL=d(instanceOptions.url);if(useGlobalHTML5Audio){if(dURL===lastGlobalHTML5URL){sameURL=true}}else if(dURL===lastURL){sameURL=true}if(a){if(a._s){if(useGlobalHTML5Audio){if(a._s&&a._s.playState&&!sameURL){a._s.stop()}}else if(!useGlobalHTML5Audio&&dURL===d(lastURL)){s._apply_loop(a,instanceOptions.loops);return a}}if(!sameURL){resetProperties(false);a.src=instanceOptions.url;s.url=instanceOptions.url;lastURL=instanceOptions.url;lastGlobalHTML5URL=instanceOptions.url;a._called_load=false}}else{if(instanceOptions.autoLoad||instanceOptions.autoPlay){s._a=new Audio(instanceOptions.url)}else{s._a=isOpera&&opera.version()<10?new Audio(null):new Audio}a=s._a;a._called_load=false;if(useGlobalHTML5Audio){globalHTML5Audio=a}}s.isHTML5=true;s._a=a;a._s=s;add_html5_events();s._apply_loop(a,instanceOptions.loops);if(instanceOptions.autoLoad||instanceOptions.autoPlay){s.load()}else{a.autobuffer=false;a.preload="auto"}return a};add_html5_events=function(){function add(oEvt,oFn,bCapture){return s._a?s._a.addEventListener(oEvt,oFn,bCapture||false):null}var f;if(s._a._added_events){return false}s._a._added_events=true;for(f in html5_events){if(html5_events.hasOwnProperty(f)){add(f,html5_events[f])}}return true};remove_html5_events=function(){function remove(oEvt,oFn,bCapture){return s._a?s._a.removeEventListener(oEvt,oFn,bCapture||false):null}var f;sm2._wD(s.id+": Removing event listeners");s._a._added_events=false;for(f in html5_events){if(html5_events.hasOwnProperty(f)){remove(f,html5_events[f])}}};this._onload=function(nSuccess){var loadOK=!!nSuccess||!s.isHTML5&&fV===8&&s.duration,fN=s.id+": ";sm2._wD(fN+(loadOK?"onload()":"Failed to load? - "+s.url),loadOK?1:2);if(!loadOK&&!s.isHTML5){if(sm2.sandbox.noRemote===true){sm2._wD(fN+str("noNet"),1)}if(sm2.sandbox.noLocal===true){sm2._wD(fN+str("noLocal"),1)}}s.loaded=loadOK;s.readyState=loadOK?3:2;s._onbufferchange(0);if(s._iO.onload){s._iO.onload.apply(s,[loadOK])}return true};this._onbufferchange=function(nIsBuffering){if(s.playState===0){return false}if(nIsBuffering&&s.isBuffering||!nIsBuffering&&!s.isBuffering){return false}s.isBuffering=nIsBuffering===1;if(s._iO.onbufferchange){sm2._wD(s.id+": Buffer state change: "+nIsBuffering);s._iO.onbufferchange.apply(s)}return true};this._onsuspend=function(){if(s._iO.onsuspend){sm2._wD(s.id+": Playback suspended");s._iO.onsuspend.apply(s)}return true};this._onfailure=function(msg,level,code){s.failures++;sm2._wD(s.id+": Failures = "+s.failures);if(s._iO.onfailure&&s.failures===1){s._iO.onfailure(s,msg,level,code)}else{sm2._wD(s.id+": Ignoring failure")}};this._onfinish=function(){var io_onfinish=s._iO.onfinish;s._onbufferchange(0);s._resetOnPosition(0);if(s.instanceCount){s.instanceCount--;if(!s.instanceCount){detachOnPosition();s.playState=0;s.paused=false;s.instanceCount=0;s.instanceOptions={};s._iO={};stop_html5_timer();if(s.isHTML5){s.position=0}}if(!s.instanceCount||s._iO.multiShotEvents){if(io_onfinish){sm2._wD(s.id+": onfinish()");io_onfinish.apply(s)}}}};this._whileloading=function(nBytesLoaded,nBytesTotal,nDuration,nBufferLength){var instanceOptions=s._iO;s.bytesLoaded=nBytesLoaded;s.bytesTotal=nBytesTotal;s.duration=Math.floor(nDuration);s.bufferLength=nBufferLength;if(!s.isHTML5&&!instanceOptions.isMovieStar){if(instanceOptions.duration){s.durationEstimate=s.duration>instanceOptions.duration?s.duration:instanceOptions.duration}else{s.durationEstimate=parseInt(s.bytesTotal/s.bytesLoaded*s.duration,10)}}else{s.durationEstimate=s.duration}if(!s.isHTML5){s.buffered=[{start:0,end:s.duration}]}if((s.readyState!==3||s.isHTML5)&&instanceOptions.whileloading){instanceOptions.whileloading.apply(s)}};this._whileplaying=function(nPosition,oPeakData,oWaveformDataLeft,oWaveformDataRight,oEQData){var eqLeft,instanceOptions=s._iO;if(isNaN(nPosition)||nPosition===null){return false}s.position=Math.max(0,nPosition);s._processOnPosition();if(!s.isHTML5&&fV>8){if(instanceOptions.usePeakData&&oPeakData!==_undefined&&oPeakData){s.peakData={left:oPeakData.leftPeak,right:oPeakData.rightPeak}}if(instanceOptions.useWaveformData&&oWaveformDataLeft!==_undefined&&oWaveformDataLeft){s.waveformData={left:oWaveformDataLeft.split(","),right:oWaveformDataRight.split(",")}}if(instanceOptions.useEQData){if(oEQData!==_undefined&&oEQData&&oEQData.leftEQ){eqLeft=oEQData.leftEQ.split(",");s.eqData=eqLeft;s.eqData.left=eqLeft;if(oEQData.rightEQ!==_undefined&&oEQData.rightEQ){s.eqData.right=oEQData.rightEQ.split(",")}}}}if(s.playState===1){if(!s.isHTML5&&fV===8&&!s.position&&s.isBuffering){s._onbufferchange(0)}if(instanceOptions.whileplaying){instanceOptions.whileplaying.apply(s)}}return true};this._oncaptiondata=function(oData){sm2._wD(s.id+": Caption data received.");s.captiondata=oData;if(s._iO.oncaptiondata){s._iO.oncaptiondata.apply(s,[oData])}};this._onmetadata=function(oMDProps,oMDData){var oData,i,j;sm2._wD(s.id+": Metadata received.");oData={};for(i=0,j=oMDProps.length;i<j;i++){oData[oMDProps[i]]=oMDData[i]}s.metadata=oData;if(s._iO.onmetadata){s._iO.onmetadata.apply(s)}};this._onid3=function(oID3Props,oID3Data){var oData,i,j;sm2._wD(s.id+": ID3 data received.");oData=[];for(i=0,j=oID3Props.length;i<j;i++){oData[oID3Props[i]]=oID3Data[i]}s.id3=mixin(s.id3,oData);if(s._iO.onid3){s._iO.onid3.apply(s)}};this._onconnect=function(bSuccess){bSuccess=bSuccess===1;sm2._wD(s.id+": "+(bSuccess?"Connected.":"Failed to connect? - "+s.url),bSuccess?1:2);s.connected=bSuccess;if(bSuccess){s.failures=0;if(idCheck(s.id)){if(s.getAutoPlay()){s.play(_undefined,s.getAutoPlay())}else if(s._iO.autoLoad){s.load()}}if(s._iO.onconnect){s._iO.onconnect.apply(s,[bSuccess])}}};this._ondataerror=function(sError){if(s.playState>0){sm2._wD(s.id+": Data error: "+sError);if(s._iO.ondataerror){s._iO.ondataerror.apply(s)}}};this._debug()};getDocument=function(){return doc.body||doc._docElement||doc.getElementsByTagName("div")[0]};id=function(sID){return doc.getElementById(sID)};mixin=function(oMain,oAdd){var o,o1=oMain||{},o2=oAdd===_undefined?sm2.defaultOptions:oAdd;for(o in o2){if(o2.hasOwnProperty(o)&&o1[o]===_undefined){if(typeof 
o2[o]!=="object"||o2[o]===null){o1[o]=o2[o]}else{o1[o]=mixin(o1[o],o2[o])}}}return o1};extraOptions={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1};assign=function(o,oParent){var i,result=true,hasParent=oParent!==_undefined,setupOptions=sm2.setupOptions,bonusOptions=extraOptions;if(o===_undefined){result=[];for(i in setupOptions){if(setupOptions.hasOwnProperty(i)){result.push(i)}}for(i in bonusOptions){if(bonusOptions.hasOwnProperty(i)){if(typeof sm2[i]==="object"){result.push(i+": {...}")}else if(sm2[i]instanceof Function){result.push(i+": function() {...}")}else{result.push(i)}}}sm2._wD(str("setup",result.join(", ")));return false}for(i in o){if(o.hasOwnProperty(i)){if(typeof o[i]!=="object"||o[i]===null||o[i]instanceof Array||o[i]instanceof RegExp){if(hasParent&&bonusOptions[oParent]!==_undefined){sm2[oParent][i]=o[i]}else if(setupOptions[i]!==_undefined){sm2.setupOptions[i]=o[i];sm2[i]=o[i]}else if(bonusOptions[i]===_undefined){complain(str(sm2[i]===_undefined?"setupUndef":"setupError",i),2);result=false}else{if(sm2[i]instanceof Function){sm2[i].apply(sm2,o[i]instanceof Array?o[i]:[o[i]])}else{sm2[i]=o[i]}}}else{if(bonusOptions[i]===_undefined){complain(str(sm2[i]===_undefined?"setupUndef":"setupError",i),2);result=false}else{return assign(o[i],i)}}}}return result};event=function(){function getArgs(oArgs){var args=slice.call(oArgs),len=args.length;if(old){args[1]="on"+args[1];if(len>3){args.pop()}}else if(len===3){args.push(false)}return args}function apply(args,sType){var element=args.shift(),method=[evt[sType]];if(old){element[method](args[0],args[1])}else{element[method].apply(element,args)}}function add(){apply(getArgs(arguments),"add")}function remove(){apply(getArgs(arguments),"remove")}var old=window.attachEvent,evt={add:old?"attachEvent":"addEventListener",remove:old?"detachEvent":"removeEventListener"};return{add:add,remove:remove}}();html5_events={abort:html5_event(function(){sm2._wD(this._s.id+": abort")}),canplay:html5_event(function(){var position1K,s=this._s;if(s._html5_canplay){return true}s._html5_canplay=true;sm2._wD(s.id+": canplay");s._onbufferchange(0);position1K=s._iO.position!==_undefined&&!isNaN(s._iO.position)?s._iO.position/1e3:null;if(s.position&&this.currentTime!==position1K){sm2._wD(s.id+": canplay: Setting position to "+position1K);try{this.currentTime=position1K}catch(ee){sm2._wD(s.id+": canplay: Setting position of "+position1K+" failed: "+ee.message,2)}}if(s._iO._oncanplay){s._iO._oncanplay()}}),canplaythrough:html5_event(function(){var s=this._s;if(!s.loaded){s._onbufferchange(0);s._whileloading(s.bytesLoaded,s.bytesTotal,s._get_html5_duration());s._onload(true)}}),ended:html5_event(function(){var s=this._s;sm2._wD(s.id+": ended");s._onfinish()}),error:html5_event(function(){sm2._wD(this._s.id+": HTML5 error, code "+this.error.code);this._s._onload(false)}),loadeddata:html5_event(function(){var s=this._s;sm2._wD(s.id+": loadeddata");if(!s._loaded&&!isSafari){s.duration=s._get_html5_duration()}}),loadedmetadata:html5_event(function(){sm2._wD(this._s.id+": loadedmetadata")}),loadstart:html5_event(function(){sm2._wD(this._s.id+": loadstart");this._s._onbufferchange(1)}),play:html5_event(function(){sm2._wD(this._s.id+": play()");this._s._onbufferchange(0)}),playing:html5_event(function(){sm2._wD(this._s.id+": playing");this._s._onbufferchange(0)}),progress:html5_event(function(e){var i,j,str,s=this._s,buffered=0,isProgress=e.type==="progress",ranges=e.target.buffered,loaded=e.loaded||0,total=e.total||1,scale=1e3;s.buffered=[];if(ranges&&ranges.length){for(i=0,j=ranges.length;i<j;i++){s.buffered.push({start:ranges.start(i)*scale,end:ranges.end(i)*scale})}buffered=(ranges.end(0)-ranges.start(0))*scale;loaded=buffered/(e.target.duration*scale);if(isProgress&&ranges.length>1){str=[];j=ranges.length;for(i=0;i<j;i++){str.push(e.target.buffered.start(i)*scale+"-"+e.target.buffered.end(i)*scale)}sm2._wD(this._s.id+": progress, timeRanges: "+str.join(", "))}if(isProgress&&!isNaN(loaded)){sm2._wD(this._s.id+": progress, "+Math.floor(loaded*100)+"% loaded")}}if(!isNaN(loaded)){s._onbufferchange(0);s._whileloading(loaded,total,s._get_html5_duration());if(loaded&&total&&loaded===total){html5_events.canplaythrough.call(this,e)}}}),ratechange:html5_event(function(){sm2._wD(this._s.id+": ratechange")}),suspend:html5_event(function(e){var s=this._s;sm2._wD(this._s.id+": suspend");html5_events.progress.call(this,e);s._onsuspend()}),stalled:html5_event(function(){sm2._wD(this._s.id+": stalled")}),timeupdate:html5_event(function(){this._s._onTimer()}),waiting:html5_event(function(){var s=this._s;sm2._wD(this._s.id+": waiting");s._onbufferchange(1)})};html5OK=function(iO){var result;if(iO.serverURL||iO.type&&preferFlashCheck(iO.type)){result=false}else{result=iO.type?html5CanPlay({type:iO.type}):html5CanPlay({url:iO.url})||sm2.html5Only}return result};html5Unload=function(oAudio,url){if(oAudio){oAudio.src=url;oAudio._called_load=false}if(useGlobalHTML5Audio){lastGlobalHTML5URL=null}};html5CanPlay=function(o){var url,mime,aF,result,offset,fileExt,item;if(!sm2.useHTML5Audio||!sm2.hasHTML5){return false}url=o.url||null,mime=o.type||null,aF=sm2.audioFormats;if(mime&&sm2.html5[mime]!==_undefined){return sm2.html5[mime]&&!preferFlashCheck(mime)}if(!html5Ext){html5Ext=[];for(item in aF){if(aF.hasOwnProperty(item)){html5Ext.push(item);if(aF[item].related){html5Ext=html5Ext.concat(aF[item].related)}}}html5Ext=new RegExp("\\.("+html5Ext.join("|")+")(\\?.*)?$","i")}fileExt=url?url.toLowerCase().match(html5Ext):null;if(!fileExt||!fileExt.length){if(!mime){result=false}else{offset=mime.indexOf(";");fileExt=(offset!==-1?mime.substr(0,offset):mime).substr(6)}}else{fileExt=fileExt[1]}if(fileExt&&sm2.html5[fileExt]!==_undefined){result=sm2.html5[fileExt]&&!preferFlashCheck(fileExt)}else{mime="audio/"+fileExt;result=sm2.html5.canPlayType({type:mime});sm2.html5[fileExt]=result;result=result&&sm2.html5[mime]&&!preferFlashCheck(mime)}return result};testHTML5=function(){function cp(m){var canPlay,i,j,result=false,isOK=false;if(!a||typeof a.canPlayType!=="function"){return result}if(m instanceof Array){for(i=0,j=m.length;i<j;i++){if(sm2.html5[m[i]]||a.canPlayType(m[i]).match(sm2.html5Test)){isOK=true;sm2.html5[m[i]]=true;sm2.flash[m[i]]=!!m[i].match(flashMIME)}}result=isOK}else{canPlay=a&&typeof a.canPlayType==="function"?a.canPlayType(m):false;result=!!(canPlay&&canPlay.match(sm2.html5Test))}return result}var a,item,lookup,support,aF,i;if(!sm2.useHTML5Audio||!sm2.hasHTML5){return false}a=Audio!==_undefined?isOpera&&opera.version()<10?new Audio(null):new Audio:null,support={};aF=sm2.audioFormats;for(item in aF){if(aF.hasOwnProperty(item)){lookup="audio/"+item;support[item]=cp(aF[item].type);support[lookup]=support[item];if(item.match(flashMIME)){sm2.flash[item]=true;sm2.flash[lookup]=true}else{sm2.flash[item]=false;sm2.flash[lookup]=false}if(aF[item]&&aF[item].related){for(i=aF[item].related.length-1;i>=0;i--){support["audio/"+aF[item].related[i]]=support[item];sm2.html5[aF[item].related[i]]=support[item];sm2.flash[aF[item].related[i]]=support[item]}}}}support.canPlayType=a?cp:null;sm2.html5=mixin(sm2.html5,support);return true};strings={notReady:"Unavailable - wait until onready() has fired.",notOK:"Audio support is not available.",domError:sm+"exception caught while appending SWF to DOM.",spcWmode:"Removing wmode, preventing known SWF loading issue(s)",swf404:smc+"Verify that %s is a valid path.",tryDebug:"Try "+sm+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:smc+"Non-HTTP page ("+doc.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:smc+"Special case: Waiting for SWF to load with window focus...",waitForever:smc+"Waiting indefinitely for Flash (will recover if unblocked)...",waitSWF:smc+"Waiting for 100% SWF load...",needFunction:smc+"Function object expected for %s",badID:'Warning: Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:smc+"_debug(): Current sound objects",waitOnload:smc+"Waiting for window.onload()",docLoaded:smc+"Document already loaded",onload:smc+"initComplete(): calling soundManager.onload()",onloadOK:sm+".onload() complete",didInit:smc+"init(): Already called?",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:smc+"Failed to remove Flash node.",shutdown:sm+".disable(): Shutting down",queue:smc+"Queueing %s handler",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+swfCSS.swfTimedout+" CSS...",fbLoaded:"Flash loaded",flRemoved:smc+"Flash movie removed.",fbHandler:smc+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:sm+".load(): current URL already assigned.",badFV:sm+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",needFlash:smc+"Fatal error: Flash is needed to play some required formats, but is not available.",gotFocus:smc+"Got window focus.",policy:"Enabling usePolicyFile for data access",setup:sm+".setup(): allowed parameters: %s",setupError:sm+'.setup(): "%s" cannot be assigned with this method.',setupUndef:sm+'.setup(): Could not find option "%s"',setupLate:sm+".setup(): url, flashVersion and html5Test property changes will not take effect until reboot().",noURL:smc+"Flash URL required. Call soundManager.setup({url:...}) to get started.",sm2Loaded:"SoundManager 2: Ready.",reset:sm+".reset(): Removing event callbacks",mobileUA:"Mobile UA detected, preferring HTML5 by default.",globalHTML5:"Using singleton HTML5 Audio() pattern for this device."};str=function(){var i,j,args=slice.call(arguments),o=args.shift(),str=strings&&strings[o]?strings[o]:"";if(str&&args&&args.length){for(i=0,j=args.length;i<j;i++){str=str.replace("%s",args[i])}}return str};loopFix=function(sOpt){if(fV===8&&sOpt.loops>1&&sOpt.stream){_wDS("as2loop");sOpt.stream=false}return sOpt};policyFix=function(sOpt,sPre){if(sOpt&&!sOpt.usePolicyFile&&(sOpt.onid3||sOpt.usePeakData||sOpt.useWaveformData||sOpt.useEQData)){sm2._wD((sPre||"")+str("policy"));sOpt.usePolicyFile=true}return sOpt};complain=function(sMsg){if(console!==_undefined&&console.warn!==_undefined){console.warn(sMsg)}else{sm2._wD(sMsg)}};doNothing=function(){return false};disableObject=function(o){var oProp;for(oProp in o){if(o.hasOwnProperty(oProp)&&typeof o[oProp]==="function"){o[oProp]=doNothing}}oProp=null};failSafely=function(bNoDisable){if(bNoDisable===_undefined){bNoDisable=false}if(disabled||bNoDisable){sm2.disable(bNoDisable)}};normalizeMovieURL=function(smURL){var url,urlParams=null;if(smURL){if(smURL.match(/\.swf(\?.*)?$/i)){urlParams=smURL.substr(smURL.toLowerCase().lastIndexOf(".swf?")+4);if(urlParams){return smURL}}else if(smURL.lastIndexOf("/")!==smURL.length-1){smURL+="/"}}url=(smURL&&smURL.lastIndexOf("/")!==-1?smURL.substr(0,smURL.lastIndexOf("/")+1):"./")+sm2.movieURL;if(sm2.noSWFCache){url+="?ts="+(new Date).getTime()}return url};setVersionInfo=function(){var isDebug;fV=parseInt(sm2.flashVersion,10);if(fV!==8&&fV!==9){sm2._wD(str("badFV",fV,defaultFlashVersion));sm2.flashVersion=fV=defaultFlashVersion}isDebug=sm2.debugMode||sm2.debugFlash?"_debug.swf":".swf";if(sm2.useHTML5Audio&&!sm2.html5Only&&sm2.audioFormats.mp4.required&&fV<9){sm2._wD(str("needfl9"));sm2.flashVersion=fV=9}sm2.version=sm2.versionNumber+(sm2.html5Only?" (HTML5-only mode)":fV===9?" (AS3/Flash 9)":" (AS2/Flash 8)");if(fV>8){sm2.defaultOptions=mixin(sm2.defaultOptions,sm2.flash9Options);sm2.features.buffering=true;sm2.defaultOptions=mixin(sm2.defaultOptions,sm2.movieStarOptions);sm2.filePatterns.flash9=new RegExp("\\.(mp3|"+netStreamTypes.join("|")+")(\\?.*)?$","i");sm2.features.movieStar=true}else{sm2.features.movieStar=false}sm2.filePattern=sm2.filePatterns[fV!==8?"flash9":"flash8"];sm2.movieURL=(fV===8?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",isDebug);sm2.features.peakData=sm2.features.waveformData=sm2.features.eqData=fV>8};setPolling=function(bPolling,bHighPerformance){if(!flash){return false}flash._setPolling(bPolling,bHighPerformance)};initDebug=function(){var oD,oDebug,oTarget,oToggle,tmp;if(sm2.debugURLParam.test(wl)){sm2.debugMode=true}if(id(sm2.debugID)){return false}if(sm2.debugMode&&!id(sm2.debugID)&&(!hasConsole||!sm2.useConsole||!sm2.consoleOnly)){oD=doc.createElement("div");oD.id=sm2.debugID+"-toggle";oToggle={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001};oD.appendChild(doc.createTextNode("-"));oD.onclick=toggleDebug;oD.title="Toggle SM2 debug console";if(ua.match(/msie 6/i)){oD.style.position="absolute";oD.style.cursor="hand"}for(tmp in oToggle){if(oToggle.hasOwnProperty(tmp)){oD.style[tmp]=oToggle[tmp]}}oDebug=doc.createElement("div");oDebug.id=sm2.debugID;oDebug.style.display=sm2.debugMode?"block":"none";if(sm2.debugMode&&!id(oD.id)){try{oTarget=getDocument();oTarget.appendChild(oD)}catch(e2){throw new Error(str("domError")+" \n"+e2.toString())}oTarget.appendChild(oDebug)}}oTarget=null};idCheck=this.getSoundById;_wDS=function(o,errorLevel){return!o?"":sm2._wD(str(o),errorLevel)};toggleDebug=function(){var o=id(sm2.debugID),oT=id(sm2.debugID+"-toggle");if(!o){return false}if(debugOpen){oT.innerHTML="+";o.style.display="none"}else{oT.innerHTML="-";o.style.display="block"}debugOpen=!debugOpen};debugTS=function(sEventType,bSuccess,sMessage){if(window.sm2Debugger!==_undefined){try{sm2Debugger.handleEvent(sEventType,bSuccess,sMessage)}catch(e){}}return true};getSWFCSS=function(){var css=[];if(sm2.debugMode){css.push(swfCSS.sm2Debug)}if(sm2.debugFlash){css.push(swfCSS.flashDebug)}if(sm2.useHighPerformance){css.push(swfCSS.highPerf)}return css.join(" ")};flashBlockHandler=function(){var name=str("fbHandler"),p=sm2.getMoviePercent(),css=swfCSS,error={type:"FLASHBLOCK"};if(sm2.html5Only){return false}if(!sm2.ok()){if(needsFlash){sm2.oMC.className=getSWFCSS()+" "+css.swfDefault+" "+(p===null?css.swfTimedout:css.swfError);sm2._wD(name+": "+str("fbTimeout")+(p?" ("+str("fbLoaded")+")":""))}sm2.didFlashBlock=true;processOnEvents({type:"ontimeout",ignoreInit:true,error:error});catchError(error)}else{if(sm2.didFlashBlock){sm2._wD(name+": Unblocked")}if(sm2.oMC){sm2.oMC.className=[getSWFCSS(),css.swfDefault,css.swfLoaded+(sm2.didFlashBlock?" "+css.swfUnblocked:"")].join(" ")}}};addOnEvent=function(sType,oMethod,oScope){if(on_queue[sType]===_undefined){on_queue[sType]=[]}on_queue[sType].push({method:oMethod,scope:oScope||null,fired:false})};processOnEvents=function(oOptions){var status,srcQueue,queue,i,j,args,canRetry;if(!oOptions){oOptions={type:sm2.ok()?"onready":"ontimeout"}}if(!didInit&&oOptions&&!oOptions.ignoreInit){return false}if(oOptions.type==="ontimeout"&&(sm2.ok()||disabled&&!oOptions.ignoreInit)){return false}status={success:oOptions&&oOptions.ignoreInit?sm2.ok():!disabled},srcQueue=oOptions&&oOptions.type?on_queue[oOptions.type]||[]:[],queue=[],args=[status],canRetry=needsFlash&&!sm2.ok();if(oOptions.error){args[0].error=oOptions.error}for(i=0,j=srcQueue.length;i<j;i++){if(srcQueue[i].fired!==true){queue.push(srcQueue[i])}}if(queue.length){for(i=0,j=queue.length;i<j;i++){if(queue[i].scope){queue[i].method.apply(queue[i].scope,args)}else{queue[i].method.apply(this,args)}if(!canRetry){queue[i].fired=true}}}return true};initUserOnload=function(){window.setTimeout(function(){if(sm2.useFlashBlock){flashBlockHandler()}processOnEvents();if(typeof sm2.onload==="function"){_wDS("onload",1);sm2.onload.apply(window);_wDS("onloadOK",1)}if(sm2.waitForWindowLoad){event.add(window,"load",initUserOnload)}},1)};detectFlash=function(){var hasPlugin,n,nP,obj,type,types,AX;if(hasFlash!==_undefined){return hasFlash}hasPlugin=false,n=navigator,nP=n.plugins,AX=window.ActiveXObject;if(nP&&nP.length){type="application/x-shockwave-flash";types=n.mimeTypes;if(types&&types[type]&&types[type].enabledPlugin&&types[type].enabledPlugin.description){hasPlugin=true}}else if(AX!==_undefined&&!ua.match(/MSAppHost/i)){try{obj=new AX("ShockwaveFlash.ShockwaveFlash")}catch(e){}hasPlugin=!!obj;obj=null}hasFlash=hasPlugin;return hasPlugin};featureCheck=function(){var needsFlash,item,result=true,formats=sm2.audioFormats,isSpecial=is_iDevice&&!!ua.match(/os (1|2|3_0|3_1)/i);if(isSpecial){sm2.hasHTML5=false;sm2.html5Only=true;if(sm2.oMC){sm2.oMC.style.display="none"}result=false}else{if(sm2.useHTML5Audio){if(!sm2.html5||!sm2.html5.canPlayType){sm2._wD("SoundManager: No HTML5 Audio() support detected.");sm2.hasHTML5=false}if(isBadSafari){sm2._wD(smc+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(!hasFlash?" would use flash fallback for MP3/MP4, but none detected.":"will use flash fallback for MP3/MP4, if available"),1)}}}if(sm2.useHTML5Audio&&sm2.hasHTML5){for(item in formats){if(formats.hasOwnProperty(item)){if(formats[item].required&&!sm2.html5.canPlayType(formats[item].type)||sm2.preferFlash&&(sm2.flash[item]||sm2.flash[formats[item].type])){needsFlash=true}}}}if(sm2.ignoreFlash){needsFlash=false}sm2.html5Only=sm2.hasHTML5&&sm2.useHTML5Audio&&!needsFlash;return!sm2.html5Only};parseURL=function(url){var i,j,result,urlResult=0;if(url instanceof Array){for(i=0,j=url.length;i<j;i++){if(url[i]instanceof Object){if(sm2.canPlayMIME(url[i].type)){urlResult=i;break}}else if(sm2.canPlayURL(url[i])){urlResult=i;break}}if(url[urlResult].url){url[urlResult]=url[urlResult].url}result=url[urlResult]}else{result=url}return result};startTimer=function(oSound){if(!oSound._hasTimer){oSound._hasTimer=true;if(!mobileHTML5&&sm2.html5PollingInterval){if(h5IntervalTimer===null&&h5TimerCount===0){h5IntervalTimer=window.setInterval(timerExecute,sm2.html5PollingInterval)}h5TimerCount++}}};stopTimer=function(oSound){if(oSound._hasTimer){oSound._hasTimer=false;if(!mobileHTML5&&sm2.html5PollingInterval){h5TimerCount--}}};timerExecute=function(){var i;if(h5IntervalTimer!==null&&!h5TimerCount){window.clearInterval(h5IntervalTimer);h5IntervalTimer=null;return false}for(i=sm2.soundIDs.length-1;i>=0;i--){if(sm2.sounds[sm2.soundIDs[i]].isHTML5&&sm2.sounds[sm2.soundIDs[i]]._hasTimer){sm2.sounds[sm2.soundIDs[i]]._onTimer()}}};catchError=function(options){options=options!==_undefined?options:{};if(typeof sm2.onerror==="function"){sm2.onerror.apply(window,[{type:options.type!==_undefined?options.type:null}])}if(options.fatal!==_undefined&&options.fatal){sm2.disable()}};badSafariFix=function(){var aF,i,item;if(!isBadSafari||!detectFlash()){return false}aF=sm2.audioFormats;for(item in aF){if(aF.hasOwnProperty(item)){if(item==="mp3"||item==="mp4"){sm2._wD(sm+": Using flash fallback for "+item+" format");sm2.html5[item]=false;if(aF[item]&&aF[item].related){for(i=aF[item].related.length-1;i>=0;i--){sm2.html5[aF[item].related[i]]=false}}}}}};this._setSandboxType=function(sandboxType){var sb=sm2.sandbox;sb.type=sandboxType;sb.description=sb.types[sb.types[sandboxType]!==_undefined?sandboxType:"unknown"];if(sb.type==="localWithFile"){sb.noRemote=true;sb.noLocal=false;_wDS("secNote",2)}else if(sb.type==="localWithNetwork"){sb.noRemote=false;sb.noLocal=true}else if(sb.type==="localTrusted"){sb.noRemote=false;sb.noLocal=false}};this._externalInterfaceOK=function(flashDate,swfVersion){var e;if(sm2.swfLoaded){return false}debugTS("swf",true);debugTS("flashtojs",true);sm2.swfLoaded=true;tryInitOnFocus=false;if(isBadSafari){badSafariFix()}if(!swfVersion||swfVersion.replace(/\+dev/i,"")!==sm2.versionNumber.replace(/\+dev/i,"")){e=sm+': Fatal: JavaScript file build "'+sm2.versionNumber+'" does not match Flash SWF build "'+swfVersion+'" at '+sm2.url+". Ensure both are up-to-date.";setTimeout(function(){throw new Error(e)},0);return false}setTimeout(init,isIE?100:1)};createMovie=function(smID,smURL){function initMsg(){var options=[],str=[],delimiter=" + ",title="SoundManager "+sm2.version+(!sm2.html5Only&&sm2.useHTML5Audio?sm2.hasHTML5?" + HTML5 audio":", no HTML5 audio support":"");if(!sm2.html5Only){if(sm2.preferFlash){options.push("preferFlash")}if(sm2.useHighPerformance){options.push("useHighPerformance")}if(sm2.flashPollingInterval){options.push("flashPollingInterval ("+sm2.flashPollingInterval+"ms)")}if(sm2.html5PollingInterval){options.push("html5PollingInterval ("+sm2.html5PollingInterval+"ms)")}if(sm2.wmode){options.push("wmode ("+sm2.wmode+")")}if(sm2.debugFlash){options.push("debugFlash")}if(sm2.useFlashBlock){options.push("flashBlock")}}else{if(sm2.html5PollingInterval){options.push("html5PollingInterval ("+sm2.html5PollingInterval+"ms)")}}if(options.length){str=str.concat([options.join(delimiter)])}sm2._wD(title+(str.length?delimiter+str.join(", "):""),1);showSupport()}function param(name,value){return'<param name="'+name+'" value="'+value+'" />'}var remoteURL,localURL,swfTitle,oTarget,extraClass,isRTL,html,oEmbed,oMovie,tmp,movieHTML,oEl,s,x,sClass;if(didAppend&&appendSuccess){return false}if(sm2.html5Only){setVersionInfo();initMsg();sm2.oMC=id(sm2.movieID);init();didAppend=true;appendSuccess=true;return false}remoteURL=smURL||sm2.url,localURL=sm2.altURL||remoteURL,swfTitle="JS/Flash audio component (SoundManager 2)",oTarget=getDocument(),extraClass=getSWFCSS(),isRTL=null,html=doc.getElementsByTagName("html")[0];isRTL=html&&html.dir&&html.dir.match(/rtl/i);smID=smID===_undefined?sm2.id:smID;setVersionInfo();sm2.url=normalizeMovieURL(overHTTP?remoteURL:localURL);smURL=sm2.url;sm2.wmode=!sm2.wmode&&sm2.useHighPerformance?"transparent":sm2.wmode;if(sm2.wmode!==null&&(ua.match(/msie 8/i)||!isIE&&!sm2.useHighPerformance)&&navigator.platform.match(/win32|win64/i)){messages.push(strings.spcWmode);sm2.wmode=null}oEmbed={name:smID,id:smID,src:smURL,quality:"high",allowScriptAccess:sm2.allowScriptAccess,bgcolor:sm2.bgColor,pluginspage:http+"www.macromedia.com/go/getflashplayer",title:swfTitle,type:"application/x-shockwave-flash",wmode:sm2.wmode,hasPriority:"true"};if(sm2.debugFlash){oEmbed.FlashVars="debug=1"}if(!sm2.wmode){delete oEmbed.wmode}if(isIE){oMovie=doc.createElement("div");movieHTML=['<object id="'+smID+'" data="'+smURL+'" type="'+oEmbed.type+'" title="'+oEmbed.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+http+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',param("movie",smURL),param("AllowScriptAccess",sm2.allowScriptAccess),param("quality",oEmbed.quality),sm2.wmode?param("wmode",sm2.wmode):"",param("bgcolor",sm2.bgColor),param("hasPriority","true"),sm2.debugFlash?param("FlashVars",oEmbed.FlashVars):"","</object>"].join("")}else{oMovie=doc.createElement("embed");for(tmp in oEmbed){if(oEmbed.hasOwnProperty(tmp)){oMovie.setAttribute(tmp,oEmbed[tmp])}}}initDebug();extraClass=getSWFCSS();oTarget=getDocument();if(oTarget){sm2.oMC=id(sm2.movieID)||doc.createElement("div");if(!sm2.oMC.id){sm2.oMC.id=sm2.movieID;sm2.oMC.className=swfCSS.swfDefault+" "+extraClass;s=null;oEl=null;if(!sm2.useFlashBlock){if(sm2.useHighPerformance){s={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}}else{s={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"};if(isRTL){s.left=Math.abs(parseInt(s.left,10))+"px"}}}if(isWebkit){sm2.oMC.style.zIndex=1e4}if(!sm2.debugFlash){for(x in s){if(s.hasOwnProperty(x)){sm2.oMC.style[x]=s[x]}}}try{if(!isIE){sm2.oMC.appendChild(oMovie)}oTarget.appendChild(sm2.oMC);if(isIE){oEl=sm2.oMC.appendChild(doc.createElement("div"));oEl.className=swfCSS.swfBox;oEl.innerHTML=movieHTML}appendSuccess=true}catch(e){throw new Error(str("domError")+" \n"+e.toString())}}else{sClass=sm2.oMC.className;sm2.oMC.className=(sClass?sClass+" ":swfCSS.swfDefault)+(extraClass?" "+extraClass:"");sm2.oMC.appendChild(oMovie);if(isIE){oEl=sm2.oMC.appendChild(doc.createElement("div"));oEl.className=swfCSS.swfBox;oEl.innerHTML=movieHTML}appendSuccess=true}}didAppend=true;initMsg();return true};initMovie=function(){if(sm2.html5Only){createMovie();return false}if(flash){return false}if(!sm2.url){_wDS("noURL");return false}flash=sm2.getMovie(sm2.id);if(!flash){if(!oRemoved){createMovie(sm2.id,sm2.url)}else{if(!isIE){sm2.oMC.appendChild(oRemoved)}else{sm2.oMC.innerHTML=oRemovedHTML}oRemoved=null;didAppend=true}flash=sm2.getMovie(sm2.id)}if(typeof sm2.oninitmovie==="function"){setTimeout(sm2.oninitmovie,1)}flushMessages();return true};delayWaitForEI=function(){setTimeout(waitForEI,1e3)};waitForEI=function(){var p,loadIncomplete=false;if(!sm2.url){return false}if(waitingForEI){return false}waitingForEI=true;event.remove(window,"load",delayWaitForEI);if(tryInitOnFocus&&!isFocused){_wDS("waitFocus");return false}if(!didInit){p=sm2.getMoviePercent();if(p>0&&p<100){loadIncomplete=true}}setTimeout(function(){p=sm2.getMoviePercent();if(loadIncomplete){waitingForEI=false;sm2._wD(str("waitSWF"));window.setTimeout(delayWaitForEI,1);return false}if(!didInit){sm2._wD(sm+": No Flash response within expected time. Likely causes: "+(p===0?"SWF load failed, ":"")+"Flash blocked or JS-Flash security error."+(sm2.debugFlash?" "+str("checkSWF"):""),2);if(!overHTTP&&p){_wDS("localFail",2);if(!sm2.debugFlash){_wDS("tryDebug",2)}}if(p===0){sm2._wD(str("swf404",sm2.url),1)}debugTS("flashtojs",false,": Timed out"+overHTTP?" (Check flash security or flash blockers)":" (No plugin/missing SWF?)")}if(!didInit&&okToDisable){if(p===null){if(sm2.useFlashBlock||sm2.flashLoadTimeout===0){if(sm2.useFlashBlock){flashBlockHandler()}_wDS("waitForever")}else{_wDS("waitForever");processOnEvents({type:"ontimeout",ignoreInit:true})}}else{if(sm2.flashLoadTimeout===0){_wDS("waitForever")}else{failSafely(true)}}}},sm2.flashLoadTimeout)};handleFocus=function(){function cleanup(){event.remove(window,"focus",handleFocus)}if(isFocused||!tryInitOnFocus){cleanup();return true}okToDisable=true;isFocused=true;_wDS("gotFocus");waitingForEI=false;delayWaitForEI();cleanup();return true};flushMessages=function(){if(messages.length){sm2._wD("SoundManager 2: "+messages.join(" "),1);messages=[]}};showSupport=function(){var item,tests;flushMessages();tests=[];if(sm2.useHTML5Audio&&sm2.hasHTML5){for(item in sm2.audioFormats){if(sm2.audioFormats.hasOwnProperty(item)){tests.push(item+" = "+sm2.html5[item]+(!sm2.html5[item]&&hasFlash&&sm2.flash[item]?" (using flash)":sm2.preferFlash&&sm2.flash[item]&&hasFlash?" (preferring flash)":!sm2.html5[item]?" ("+(sm2.audioFormats[item].required?"required, ":"")+"and no flash support)":""))}}sm2._wD("SoundManager 2 HTML5 support: "+tests.join(", "),1)}};initComplete=function(bNoDisable){var wasTimeout,result,error;if(didInit){return false}if(sm2.html5Only){_wDS("sm2Loaded");didInit=true;initUserOnload();debugTS("onload",true);return true}wasTimeout=sm2.useFlashBlock&&sm2.flashLoadTimeout&&!sm2.getMoviePercent(),result=true;if(!wasTimeout){didInit=true;if(disabled){error={type:!hasFlash&&needsFlash?"NO_FLASH":"INIT_TIMEOUT"}}}sm2._wD("SoundManager 2 "+(disabled?"failed to load":"loaded")+" ("+(disabled?"Flash security/load error":"OK")+")",disabled?2:1);if(disabled||bNoDisable){if(sm2.useFlashBlock&&sm2.oMC){sm2.oMC.className=getSWFCSS()+" "+(sm2.getMoviePercent()===null?swfCSS.swfTimedout:swfCSS.swfError)}processOnEvents({type:"ontimeout",error:error,ignoreInit:true});debugTS("onload",false);catchError(error);result=false}else{debugTS("onload",true)}if(!disabled){if(sm2.waitForWindowLoad&&!windowLoaded){_wDS("waitOnload");event.add(window,"load",initUserOnload)}else{if(sm2.waitForWindowLoad&&windowLoaded){_wDS("docLoaded")}initUserOnload()}}return result};setProperties=function(){var i,o=sm2.setupOptions;for(i in o){if(o.hasOwnProperty(i)){if(sm2[i]===_undefined){sm2[i]=o[i]}else if(sm2[i]!==o[i]){sm2.setupOptions[i]=sm2[i]}}}};init=function(){function cleanup(){event.remove(window,"load",sm2.beginDelayedInit)}if(didInit){_wDS("didInit");return false}if(sm2.html5Only){if(!didInit){cleanup();sm2.enabled=true;initComplete()}return true}initMovie();try{flash._externalInterfaceTest(false);setPolling(true,sm2.flashPollingInterval||(sm2.useHighPerformance?10:50));if(!sm2.debugMode){flash._disableDebug()}sm2.enabled=true;debugTS("jstoflash",true);if(!sm2.html5Only){event.add(window,"unload",doNothing)}}catch(e){sm2._wD("js/flash exception: "+e.toString());debugTS("jstoflash",false);catchError({type:"JS_TO_FLASH_EXCEPTION",fatal:true});failSafely(true);initComplete();return false}initComplete();cleanup();return true};domContentLoaded=function(){if(didDCLoaded){return false}didDCLoaded=true;setProperties();initDebug();(function(){var a="sm2-usehtml5audio=",a2="sm2-preferflash=",b=null,b2=null,hasCon=window.console!==_undefined&&typeof console.log==="function",l=wl.toLowerCase();if(l.indexOf(a)!==-1){b=l.charAt(l.indexOf(a)+a.length)==="1";if(hasCon){console.log((b?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter")}sm2.setup({useHTML5Audio:b})}if(l.indexOf(a2)!==-1){b2=l.charAt(l.indexOf(a2)+a2.length)==="1";if(hasCon){console.log((b2?"Enabling ":"Disabling ")+"preferFlash via URL parameter")}sm2.setup({preferFlash:b2})}})();if(!hasFlash&&sm2.hasHTML5){sm2._wD("SoundManager: No Flash detected"+(!sm2.useHTML5Audio?", enabling HTML5.":". Trying HTML5-only mode."),1);sm2.setup({useHTML5Audio:true,preferFlash:false})}testHTML5();sm2.html5.usingFlash=featureCheck();needsFlash=sm2.html5.usingFlash;if(!hasFlash&&needsFlash){messages.push(strings.needFlash);sm2.setup({flashLoadTimeout:1})}if(doc.removeEventListener){doc.removeEventListener("DOMContentLoaded",domContentLoaded,false)}initMovie();return true};domContentLoadedIE=function(){if(doc.readyState==="complete"){domContentLoaded();doc.detachEvent("onreadystatechange",domContentLoadedIE)}return true};winOnLoad=function(){windowLoaded=true;event.remove(window,"load",winOnLoad)};preInit=function(){if(mobileHTML5){if(!sm2.setupOptions.useHTML5Audio||sm2.setupOptions.preferFlash){messages.push(strings.mobileUA)}sm2.setupOptions.useHTML5Audio=true;sm2.setupOptions.preferFlash=false;if(is_iDevice||isAndroid&&!ua.match(/android\s2\.3/i)){messages.push(strings.globalHTML5);if(is_iDevice){sm2.ignoreFlash=true}useGlobalHTML5Audio=true}}};preInit();detectFlash();event.add(window,"focus",handleFocus);event.add(window,"load",delayWaitForEI);event.add(window,"load",winOnLoad);if(doc.addEventListener){doc.addEventListener("DOMContentLoaded",domContentLoaded,false)}else if(doc.attachEvent){doc.attachEvent("onreadystatechange",domContentLoadedIE)}else{debugTS("onload",false);catchError({type:"NO_DOM2_EVENTS",fatal:true})}}var soundManager=null;if(window.SM2_DEFER===undefined||!SM2_DEFER){soundManager=new SoundManager}window.SoundManager=SoundManager;window.soundManager=soundManager})(window);br_sm2=function(){function setupSM2(onSMReady){soundManager.setup(sm2_settings);soundManager.onready(function(){onSMReady()})}function whilePlaying(sound){var duration=badracket.stringToTime(br_player.state.currSong.duration),position=sound.position,isSliding=br_player.state.isSliding;playbarWidth=(position/duration*100).toFixed(2)+"%";if(!isSliding&&br_player.state.currSong.sm2_obj===sound){br_player.ui.el.progressBar.css("width",playbarWidth);br_player.ui.el.progressTime.text(badracket.msToTime(position))}}function onFinish(sound){console.log("on finish ran");sound.setPosition(0);br_player.ui.handlers.nextPrev("next")}function createSound(song,isInline){if(song.isSampleTrack==="0"){song.duration="0:30"}console.log("create sound ran");if(isInline){return soundManager.createSound({id:"brSound"+songCount++,url:song.songUrl,autoLoad:true})}return soundManager.createSound({id:"brSound"+songCount++,url:song.songUrl,autoLoad:true,onplay:function(){br_player.state.isPlaying=true;$(window).trigger("sm2-play-event")},onresume:function(){br_player.state.isPlaying=true;$(window).trigger("sm2-play-event")},onpause:function(){br_player.state.isPlaying=false},onstop:function(){br_player.state.isPlaying=false},whileplaying:function(){whilePlaying(this)},onfinish:function(){onFinish(this)}})}function previousLoadCheck(){var lastPlayed=br_player.history.song.lastPlayed();if(typeof lastPlayed!=="undefined"&&"sm2_obj"in 
lastPlayed){if(lastPlayed.sm2_obj.loaded===false){lastPlayed.sm2_obj.unload()}}}function playPause(song,isPause,isInline){console.log("play-pause ran");previousLoadCheck();if(!("sm2_obj"in song)){song.sm2_obj=createSound(song,isInline)}br_player.logic.attach30SecondListener(song);if(isPause){song.sm2_obj.stop()}else{song.sm2_obj.togglePause()}}var sm2_settings={url:"swf",flashVersion:9,debugMode:false,flashPollingInterval:125,html5PollingInterval:125,useHighPerformance:true};var songCount=0;return{setup:setupSM2,createSound:createSound,playPause:playPause,onFinish:onFinish}}();br_inline_player=function(){function songAlreadyExists(songURL){var exists;_.each(allSongs,function(song){if(song.songUrl===songURL){exists=song}});return exists}var allSongs=[];var bindUI={playClick:function(){console.log("inline-play-click-bound");s.bd.on({click:function(e){handlers.playClick(e)}},".inline-play-pause")}};var handlers={playClick:function(e){var el=$(e.target).closest(".inline-player"),songURL=el.data("song-url"),exists=songAlreadyExists(songURL),button=el.find(".inline-play-pause");$(window).trigger("vimeo-play-event",songURL);if(exists){exists.sm2_obj.togglePause();var icn2=exists.sm2_obj.paused?"m":"n";button.attr("data-icon",icn2)}else{var song={songUrl:songURL};allSongs.push(song);br_sm2.playPause(song,false,true);button.attr("data-icon","n");$(window).on("sm2-play-event vimeo-play-event",function(_,songURL){if(songURL===song.songUrl){return false}song.sm2_obj.pause();button.attr("data-icon","m")})}}};return{bindUI:bindUI}}();br_inline_player.bindUI.playClick();br_player=function(){var state={isPreviewSong:false,isSliding:false,isPlaying:false,currSong:null,currAlbum:null};var ui=function(){var el={playerWrapper:$(".audio-player-wrapper"),player:$(".audio-player"),song:$(".audio-player .song"),artist:$(".audio-player .artist"),albumLink:$(".audio-player .view-full-album"),progressBar:$(".audio-player .progress-bar"),progressTime:$(".audio-player .progress-time"),currentTrack:$(".audio-player .current-track"),totalTracks:$(".audio-player .total-tracks"),slider:$(".slider"),playButton:$(".play-pause"),prevButton:$(".previous"),nextButton:$(".next"),ctaWrap:$(".support-band"),ctaButton:$(".support-band-button")};var iconFont={play:"m",pause:"n",speaker:"s"};var render={init:function(album,song){el.player.addClass("ready");if(album.kind==="show"){el.artist.html(song.artist);var humanDate=date("M j",new Date(album.date));el.albumLink.find(".target").text("Playing "+humanDate+": view show");el.albumLink.find(".track-count").hide();el.ctaWrap.attr("data-toggle","none");el.ctaWrap.attr("href",album.albumUrl);el.ctaButton.text("Get Tickets")}else{el.artist.html(album.artist);el.albumLink.find(".track-count").show();el.albumLink.find(".target").text("View album");el.ctaWrap.attr("data-toggle","modal");el.ctaWrap.attr("href","#buy-album-form");el.ctaButton.text("Get Album")}el.song.html(song.songTitle);el.progressBar.css("width","0%");el.progressTime.html(song.duration);el.albumLink.attr("href",album.albumUrl);el.currentTrack.html(parseInt(song.trackNumber,10));el.totalTracks.html(album.tracks.length)},playState:function(){var icn=state.isPlaying?iconFont.pause:iconFont.play;el.playButton.attr("data-icon",icn)},updateTime:function(time){el.progressTime.html(time)}};var handlers={playClick:function(){br_player.logic.targetSong(state.currAlbum,state.currSong);render.playState()},albumClick:function(e){var target=$(e.target);if(br_state.viewGet()==="album-detail"||target.closest("a").hasClass("link-to-album")){return false}e.preventDefault();e.stopPropagation();var albumName=target.closest(".album").attr("data-album-title"),targetAlbum=albumData.getAlbumByName(albumName),targetSong=albumData.sampleSong(targetAlbum);logic.targetSong(targetAlbum,targetSong)},songClick:function(e){var albumName=$("[data-album-title]").attr("data-album-title"),targetAlbum=albumData.getAlbumByName(albumName),songIndex=parseInt($(e.target).closest(".song").attr("data-track-number"),10)-1,targetSong=targetAlbum.tracks[songIndex];logic.targetSong(targetAlbum,targetSong)},nextPrev:function(direction){var nextAlbumSong,prevAlbumSong;if(direction==="next"){nextAlbumSong=history.song.next();logic.targetSong(nextAlbumSong[0],nextAlbumSong[1])}else{previousAlbumSong=history.song.previous();logic.targetSong(previousAlbumSong[0],previousAlbumSong[1])}},buyAlbum:function(e){e.preventDefault();var album=br_player.state.currAlbum,title=album.albumName,file=album.zipFile,price="$"+album.price+".00",priceCents=album.price*100,artist=album.artist,cover=album.coverUrl;badracket.setupPayForm(cover,title,artist,price,file)},buyAlbumHover:function(){function paymentsLoaded(){console.log("yep");s.bd.off("hover",".support-band-button")}badracket.loader.require([badracket_theme_path+"/js/prod/payments.min.js"],paymentsLoaded())},whileSliding:function(event,ui,playbar){el.progressBar.css("width",ui.value+"%")},slideStart:function(){state.isSliding=true},slideStop:function(event,ui){state.isSliding=false;var smPosition=ui.value/100*badracket.stringToTime(state.currSong.duration);state.currSong.sm2_obj.setPosition(smPosition)}};var bindui={play:function(){s.bd.on({click:function(){handlers.playClick()}},".play-pause")},next:function(){s.bd.on({click:function(){handlers.nextPrev("next")}},".audio-player .next")},previous:function(){s.bd.on({click:function(){handlers.nextPrev("prev")}},".previous")},album:function(){s.bd.on({click:function(e){handlers.albumClick(e)}},".album")},song:function(){s.bd.on({click:function(e){handlers.songClick(e)}},".song")},buyAlbum:function(){s.bd.on({click:function(e){handlers.buyAlbum(e)}},".support-band-button")},buyAlbumHover:function(){s.bd.on({hover:function(e){handlers.buyAlbumHover(e)}},".support-band-button")},slider:function(){el.slider.slider({step:.01,slide:function(event,ui){handlers.whileSliding(event,ui)},start:function(){handlers.slideStart()},stop:function(event,ui){handlers.slideStop(event,ui)}})}};return{el:el,handlers:handlers,bindui:bindui,render:render}}();var logic=function(){function activeStyle(targetAlbum,targetSong,mode){var songDOM=$('.song[data-track-number="'+targetSong.trackNumber+'"]'),albumDOM=$('.album[data-album-title="'+targetAlbum.albumName+'"]'),currentView=br_state.viewGet();console.log(currentView);if(currentView==="album-detail"||currentView==="show-detail"){if($("[data-album-title]").attr("data-album-title")===targetAlbum.albumName){if(mode==="toggle"){songDOM.toggleClass("song-playing")}else{songDOM.removeClass("song-playing")}}}else if(currentView==="home"||currentView==="album-rollup"){if(mode==="toggle"){albumDOM.toggleClass("playing")}else{albumDOM.removeClass("playing")}}}function targetSongLogic(targetAlbum,targetSong,isPause){if(targetSong.songTitle!==state.currSong.songTitle){if(typeof state.currSong.sm2_obj!=="undefined"){state.currSong.sm2_obj.setPosition(0)}ui.render.init(targetAlbum,targetSong);activeStyle(state.currAlbum,state.currSong,"clear");if(state.isPlaying){state.currSong.sm2_obj.stop()}history.update(targetAlbum,targetSong)}activeStyle(targetAlbum,targetSong,"toggle");br_sm2.playPause(targetSong,isPause);ui.render.playState()}function attach30SecondListener(song){if(song.isSampleTrack==="0"){song.sm2_obj.onPosition(3e4,function(){br_sm2.onFinish(song.sm2_obj)})}}return{targetSong:targetSongLogic,attach30SecondListener:attach30SecondListener}}();var albumData=function(){function receiveData(cleanJSON){albums=albums.concat(cleanJSON);numAlbums=albums.length}function getAlbumByName(albumName){for(var i=numAlbums;i--;){if(albums[i].albumName===albumName){return albums[i]}}}function findSampleSong(album){var tracks=album.tracks;for(var i=0;i<tracks.length;i++){if(parseInt(tracks[i].isSampleTrack,10)==1){return tracks[i]}}}var albums=[],numAlbums;return{getAlbumByName:getAlbumByName,sampleSong:findSampleSong,set:receiveData,get:function(){return albums}}}();var history=function(){function updateHistory(album,track){currentAlbumIndex=albumData.get().indexOf(album);currentSongIndex=album.tracks.indexOf(track);historyIndexes.push([currentAlbumIndex,currentSongIndex]);updateState(album,track);console.log("updatehistory ran")}function get(){return historyIndexes}function updateState(album,track){console.log(state);state.currAlbum=album;state.currSong=track}function historyLen(){return historyIndexes.length}var historyIndexes=[],currentAlbumIndex,currentSongIndex;var album=function(){function current(){return albumData.get()[currentAlbumIndex]}function next(){return albumData.get()[currentAlbumIndex+1]}function previous(){return albumData.get()[currentAlbumIndex-1]}function random(){var albums=br_player.albumData.get();return albums[Math.round(Math.random(0,albums.length))]}return{current:current,next:next,previous:previous,random:random}}();var song=function(){function current(){return albumData.get()[currentAlbumIndex].tracks[currentSongIndex]}function populateScope(){albums=albumData.get();numAlbums=albums.length;albumTrackLen=state.currAlbum.tracks.length;nextAlbum=history.album.next();previousAlbum=history.album.previous()}function next(){populateScope();var nextIndex=currentSongIndex+1;if(nextIndex>=albumTrackLen){if(currentAlbumIndex>=numAlbums-1){var firstAlbum=albums[0],firstAlbumSong=firstAlbum.tracks[0];return[firstAlbum,firstAlbumSong]}else{var firstSong=nextAlbum.tracks[0];return[nextAlbum,firstSong]}}else{nextSong=state.currAlbum.tracks[nextIndex];return[state.currAlbum,nextSong]}}function previous(){populateScope();var previousIndex=currentSongIndex-1;if(previousIndex<0){if(currentAlbumIndex<=0){var lastAlbum=albums[numAlbums-1],lastAlbumSong=lastAlbum.tracks[lastAlbum.tracks.length-1];return[lastAlbum,lastAlbumSong]}else{var lastSong=previousAlbum.tracks[previousAlbum.tracks.length-1];return[previousAlbum,lastSong]}}else{previousSong=state.currAlbum.tracks[previousIndex];return[state.currAlbum,previousSong]}}function lastPlayed(){var previousHistory=historyIndexes[historyIndexes.length-2],previousAlbumIndex,previousSongIndex;if(typeof previousHistory!=="undefined"){previousAlbumIndex=previousHistory[0],previousSongIndex=previousHistory[1];return albumData.get()[previousAlbumIndex].tracks[previousSongIndex]}}var albums,numAlbums,albumTrackLen,nextAlbum,previousAlbum;return{current:current,next:next,previous:previous,lastPlayed:lastPlayed}}();return{get:get,update:updateHistory,length:historyLen,album:album,song:song}}();return{state:state,ui:ui,logic:logic,albumData:albumData,history:history}}();$.subscribe("/view/change",updateView("/view/change"));init=function(){function loadSM(){if(typeof soundManager!=="undefined"){br_sm2.setup(smReady)}else{setTimeout(function(){loadSM()},125)}}function smReady(){console.log("Soundmanager ready");ready.sm=true;$(window).on("vimeo-play-event",function(){var a=br_player.state.currAlbum;var s=br_player.state.currSong;br_player.logic.targetSong(a,s,true)});readyCallback()}function dataReady(type){console.log("Album data ready");ready[type]=true;readyCallback()}function readyCallback(){if(!ready.sm||!ready.album||!ready.show){return}console.log("everything is loaded");doMoreStuff()}var ready={sm:false,album:false,show:false};return{loadSM:loadSM,dataReady:dataReady,readyState:ready,init:init}}();init.loadSM();