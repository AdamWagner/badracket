(function(){var e=this;this.Stripe=function(){function e(){}return e.version=2,e.endpoint="https://api.stripe.com/v1",e.validateCardNumber=function(t){return t=(t+"").replace(/\s+|-/g,""),t.length>=10&&t.length<=16&&e.luhnCheck(t)},e.validateCVC=function(t){return t=e.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4},e.validateExpiry=function(t,n){var r,i;return t=e.trim(t),n=e.trim(n),/^\d+$/.test(t)?/^\d+$/.test(n)?parseInt(t,10)<=12?(i=new Date(n,t),r=new Date,i.setMonth(i.getMonth()-1),i.setMonth(i.getMonth()+1,1),i>r):!1:!1:!1},e.cardType=function(t){return e.cardTypes[t.slice(0,2)]||"Unknown"},e.setPublishableKey=function(t){e.key=t},e.createToken=function(t,n,r){var i,s,o;n==null&&(n={});if(!t)throw"card required";if(typeof t!="object")throw"card invalid";e.isElement(t)&&(t=e.paramsFromForm(t)),typeof n=="function"?(r=n,n={}):typeof n!="object"&&(i=parseInt(n,10),n={},i>0&&(n.amount=i));for(s in t)o=t[s],delete t[s],t[e.underscore(s)]=o;return n.card=t,n.key||(n.key=e.key||e.publishableKey),e.validateKey(n.key),e.ajaxJSONP({url:""+e.endpoint+"/tokens",data:n,method:"POST",success:function(e,t){return typeof r=="function"?r(t,e):void 0},complete:e.complete(r),timeout:4e4})},e.getToken=function(t,n){if(!t)throw"token required";return e.validateKey(e.key),e.ajaxJSONP({url:""+e.endpoint+"/tokens/"+t,data:{key:e.key},success:function(e,t){return typeof n=="function"?n(t,e):void 0},complete:e.complete(n),timeout:4e4})},e.complete=function(e){return function(t){if(t!=="success")return typeof e=="function"?e(500,{error:{code:t,type:t,message:"An unexpected error has occurred. We have been notified of the problem."}}):void 0}},e.validateKey=function(e){if(!e||typeof e!="string")throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(e))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(e))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},e}.call(this),typeof module!="undefined"&&module!==null&&(module.exports=this.Stripe),typeof define=="function"&&define("stripe",[],function(){return e.Stripe})}).call(this),function(){var r=[].slice,e=encodeURIComponent,t=(new Date).getTime(),n=function(t,r,i){var s,o;r==null&&(r=[]);for(s in t)o=t[s],i&&(s=""+i+"["+s+"]"),typeof o=="object"?n(o,r,s):r.push(""+s+"="+e(o));return r.join("&").replace(/%20/g,"+")};this.Stripe.ajaxJSONP=function(e){var i,s,o,u,a,f;return e==null&&(e={}),o="sjsonp"+ ++t,a=document.createElement("script"),s=null,i=function(){var t;return clearTimeout(s),(t=a.parentNode)!=null&&t.removeChild(a),o in window&&(window[o]=function(){}),typeof e.complete=="function"?e.complete("abort",f,e):void 0},f={abort:i},a.onerror=function(){return f.abort(),typeof e.error=="function"?e.error(f,e):void 0},window[o]=function(){var t=1<=arguments.length?r.call(arguments,0):[];clearTimeout(s),a.parentNode.removeChild(a);try{delete window[o]}catch(n){window[o]=void 0}return typeof e.success=="function"&&e.success.apply(e,t),typeof e.complete=="function"?e.complete("success",f,e):void 0},e.data||(e.data={}),e.data.callback=o,e.method&&(e.data._method=e.method),a.src=e.url+"?"+n(e.data),u=document.getElementsByTagName("head")[0],u.appendChild(a),e.timeout>0&&(s=setTimeout(function(){return f.abort(),typeof e.complete=="function"?e.complete("timeout",f,e):void 0},e.timeout)),f}}.call(this),function(){var i,f,l=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},e=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],u=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},a=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},r=function(e){return typeof e!="object"?!1:typeof jQuery!="undefined"&&jQuery!==null&&e instanceof jQuery?!0:e.nodeType===1},o=function(t,n){var r,i,s,o,u,f;n==null&&(n=!0),typeof jQuery!="undefined"&&jQuery!==null&&t instanceof jQuery&&(t=t[0]),s=t.getElementsByTagName("input"),o={};for(u=0,f=s.length;u<f;u++){i=s[u],r=a(i.getAttribute("data-stripe"));if(!(l.call(e,r)>=0||!n))continue;o[r]=i.value}return o},s=function(e){var t,s,o,r=!0,i=0,n=(e+"").split("").reverse();for(s=0,o=n.length;s<o;s++){t=n[s],t=parseInt(t,10);if(r=!r)t*=2;t>9&&(t-=9),i+=t}return i%10===0},t=function(){var e,n,r,t={};for(e=n=40;n<=49;e=++n)t[e]="Visa";for(e=r=50;r<=59;e=++r)t[e]="MasterCard";return t[34]=t[37]="American Express",t[60]=t[62]=t[64]=t[65]="Discover",t[35]="JCB",t[30]=t[36]=t[38]=t[39]="Diners Club",t}(),n={attrs:e,trim:u,underscore:a,isElement:r,paramsFromForm:o,luhnCheck:s,cardTypes:t};for(i in n)f=n[i],this.Stripe[i]=f}.call(this);(function(){var cardFromNumber,cardFromType,cards,defaultFormat,formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlash,hasTextSelected,luhnCheck,reFormatCardNumber,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,setCardType,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},_this=this,$=jQuery;$.payment={};$.payment.fn={};$.fn.payment=function(){var method=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];return $.payment.fn[method].apply(this,args)};defaultFormat=/(\d{1,4})/g;cards=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:defaultFormat,length:[14],cvcLength:[3],luhn:true},{type:"laser",pattern:/^(6706|6771|6709)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:true},{type:"jcb",pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:"unionpay",pattern:/^62/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:false},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:"mastercard",pattern:/^5[1-5]/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:true},{type:"visa",pattern:/^4/,format:defaultFormat,length:[13,14,15,16],cvcLength:[3],luhn:true}];cardFromNumber=function(num){var card,_i,_len;num=(num+"").replace(/\D/g,"");for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];if(card.pattern.test(num)){return card}}};cardFromType=function(type){var card,_i,_len;for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];if(card.type===type){return card}}};luhnCheck=function(num){var digit,_i,_len,odd=true,sum=0,digits=(num+"").split("").reverse();for(_i=0,_len=digits.length;_i<_len;_i++){digit=digits[_i];digit=parseInt(digit,10);if(odd=!odd){digit*=2}if(digit>9){digit-=9}sum+=digit}return sum%10===0};hasTextSelected=function($target){var _ref;if($target.prop("selectionStart")!=null&&$target.prop("selectionStart")!==$target.prop("selectionEnd")){return true}if(typeof document!=="undefined"&&document!==null?(_ref=document.selection)!=null?typeof _ref.createRange==="function"?_ref.createRange().text:void 0:void 0:void 0){return true}return false};reFormatCardNumber=function(e){var _this=this;return setTimeout(function(){var $target=$(e.currentTarget),value=$target.val();value=$.payment.formatCardNumber(value);return $target.val(value)})};formatCardNumber=function(e){var $target,card,length,re,upperLength,value,digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return}$target=$(e.currentTarget);value=$target.val();card=cardFromNumber(value+digit);length=(value.replace(/\D/g,"")+digit).length;upperLength=16;if(card){upperLength=card.length[card.length.length-1]}if(length>=upperLength){return}if($target.prop("selectionStart")!=null&&$target.prop("selectionStart")!==value.length){return}if(card&&card.type==="amex"){re=/^(\d{4}|\d{4}\s\d{6})$/}else{re=/(?:^|\s)(\d{4})$/}if(re.test(value)){e.preventDefault();return $target.val(value+" "+digit)}else if(re.test(value+digit)){e.preventDefault();return $target.val(value+digit+" ")}};formatBackCardNumber=function(e){var $target=$(e.currentTarget),value=$target.val();if(e.meta){return}if($target.prop("selectionStart")!=null&&$target.prop("selectionStart")!==value.length){return}if(e.which===8&&/\s\d?$/.test(value)){e.preventDefault();return $target.val(value.replace(/\s\d?$/,""))}};formatExpiry=function(e){var $target,val,digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return}$target=$(e.currentTarget);val=$target.val()+digit;if(/^\d$/.test(val)&&val!=="0"&&val!=="1"){e.preventDefault();return $target.val("0"+val+" / ")}else if(/^\d\d$/.test(val)){e.preventDefault();return $target.val(""+val+" / ")}};formatForwardExpiry=function(e){var $target,val,digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return}$target=$(e.currentTarget);val=$target.val();if(/^\d\d$/.test(val)){return $target.val(""+val+" / ")}};formatForwardSlash=function(e){var $target,val,slash=String.fromCharCode(e.which);if(slash!=="/"){return}$target=$(e.currentTarget);val=$target.val();if(/^\d$/.test(val)&&val!=="0"){return $target.val("0"+val+" / ")}};formatBackExpiry=function(e){var $target,value;if(e.meta){return}$target=$(e.currentTarget);value=$target.val();if(e.which!==8){return}if($target.prop("selectionStart")!=null&&$target.prop("selectionStart")!==value.length){return}if(/\s\/\s?\d?$/.test(value)){e.preventDefault();return $target.val(value.replace(/\s\/\s?\d?$/,""))}};restrictNumeric=function(e){var input;if(e.metaKey||e.ctrlKey){return true}if(e.which===32){return false}if(e.which===0){return true}if(e.which<33){return true}input=String.fromCharCode(e.which);return!!/[\d\s]/.test(input)};restrictCardNumber=function(e){var card,value,$target=$(e.currentTarget),digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return}if(hasTextSelected($target)){return}value=($target.val()+digit).replace(/\D/g,"");card=cardFromNumber(value);if(card){return value.length<=card.length[card.length.length-1]}else{return value.length<=16}};restrictExpiry=function(e){var value,$target=$(e.currentTarget),digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return}if(hasTextSelected($target)){return}value=$target.val()+digit;value=value.replace(/\D/g,"");if(value.length>6){return false}};restrictCVC=function(e){var val,$target=$(e.currentTarget),digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return}val=$target.val()+digit;return val.length<=4};setCardType=function(e){var allTypes,card,$target=$(e.currentTarget),val=$target.val(),cardType=$.payment.cardType(val)||"unknown";if(!$target.hasClass(cardType)){allTypes=function(){var _i,_len,_results=[];for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];_results.push(card.type)}return _results}();$target.removeClass("unknown");$target.removeClass(allTypes.join(" "));$target.addClass(cardType);$target.toggleClass("identified",cardType!=="unknown");return $target.trigger("payment.cardType",cardType)}};$.payment.fn.formatCardCVC=function(){this.payment("restrictNumeric");this.on("keypress",restrictCVC);return this};$.payment.fn.formatCardExpiry=function(){this.payment("restrictNumeric");this.on("keypress",restrictExpiry);this.on("keypress",formatExpiry);this.on("keypress",formatForwardSlash);this.on("keypress",formatForwardExpiry);this.on("keydown",formatBackExpiry);return this};$.payment.fn.formatCardNumber=function(){this.payment("restrictNumeric");this.on("keypress",restrictCardNumber);this.on("keypress",formatCardNumber);this.on("keydown",formatBackCardNumber);this.on("keyup",setCardType);this.on("paste",reFormatCardNumber);return this};$.payment.fn.restrictNumeric=function(){this.on("keypress",restrictNumeric);return this};$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())};$.payment.cardExpiryVal=function(value){var month,prefix,year,_ref;value=value.replace(/\s/g,"");_ref=value.split("/",2),month=_ref[0],year=_ref[1];if((year!=null?year.length:void 0)===2&&/^\d+$/.test(year)){prefix=(new Date).getFullYear();prefix=prefix.toString().slice(0,2);year=prefix+year}month=parseInt(month,10);year=parseInt(year,10);return{month:month,year:year}};$.payment.validateCardNumber=function(num){var card,_ref;num=(num+"").replace(/\s+|-/g,"");if(!/^\d+$/.test(num)){return false}card=cardFromNumber(num);if(!card){return false}return(_ref=num.length,__indexOf.call(card.length,_ref)>=0)&&(card.luhn===false||luhnCheck(num))};$.payment.validateCardExpiry=function(month,year){var currentTime,expiry,prefix,_ref;if(typeof month==="object"&&"month"in month){_ref=month,month=_ref.month,year=_ref.year}if(!(month&&year)){return false}month=$.trim(month);year=$.trim(year);if(!/^\d+$/.test(month)){return false}if(!/^\d+$/.test(year)){return false}if(!(parseInt(month,10)<=12)){return false}if(year.length===2){prefix=(new Date).getFullYear();prefix=prefix.toString().slice(0,2);year=prefix+year}expiry=new Date(year,month);currentTime=new Date;expiry.setMonth(expiry.getMonth()-1);expiry.setMonth(expiry.getMonth()+1,1);return expiry>currentTime};$.payment.validateCardCVC=function(cvc,type){var _ref,_ref1;cvc=$.trim(cvc);if(!/^\d+$/.test(cvc)){return false}if(type){return _ref=cvc.length,__indexOf.call((_ref1=cardFromType(type))!=null?_ref1.cvcLength:void 0,_ref)>=0}else{return cvc.length>=3&&cvc.length<=4}};$.payment.cardType=function(num){var _ref;if(!num){return null}return((_ref=cardFromNumber(num))!=null?_ref.type:void 0)||null};$.payment.formatCardNumber=function(num){var groups,upperLength,_ref,card=cardFromNumber(num);if(!card){return num}upperLength=card.length[card.length.length-1];num=num.replace(/\D/g,"");num=num.slice(0,+upperLength+1||9e9);if(card.format.global){return(_ref=num.match(card.format))!=null?_ref.join(" "):void 0}else{groups=card.format.exec(num);if(groups!=null){groups.shift()}return groups!=null?groups.join(" "):void 0}}}).call(this);(function(){(function($){var applyValidation,applyValidationMessage;$.errors={attribute:"validate",activationClass:"validation-active",format:"<div class='validation-block'><div class='validation-message'></div></div>",messageClass:"validation-message"};applyValidationMessage=function(div,message){var message_div;if(!div.hasClass($.errors.activationClass)){div.addClass($.errors.activationClass);message_div=div.find("."+$.errors.messageClass);if(message_div.size()===0)div.append($.errors.format);message_div=div.find("."+$.errors.messageClass);if(message_div.size()>0){return message_div.html(message)}else{throw new Error("configuration error: $.errors.format must have elment with class "+$.errors.messageClass)}}};applyValidation=function(form,field,message){var div=form.find("["+$.errors.attribute+"~='"+field+"']");if(div.size()===0){div=$("<div "+$.errors.attribute+"='"+field+"'>"+('Unassigned error: Add validate="'+field+'" attribute somewhere in a form.</div>'));form.prepend(div)}return applyValidationMessage(div,message)};$.fn.applyErrors=function(errors){$(this).clearErrors();return $(this).addErrors(errors)};$.fn.addErrors=function(errors){var old_errors,form=$(this);if($.type(errors)==="object"){old_errors=errors;errors=[];$.each(old_errors,function(key,value){if(value&&!($.isArray(value)&&value.length===0)){return errors.push([key,value])}})}return $(errors).each(function(key,error){var field=error[0],message=error[1];if($.isArray(message))message=message[0];return applyValidation(form,field,message)})};return $.fn.clearErrors=function(){var validators=$(this).find("["+$.errors.attribute+"]");validators.find("."+$.errors.messageClass).html("");return validators.removeClass($.errors.activationClass)}})(jQuery)}).call(this);(function(){(function($){var ajaxFormErrorHandler,ajaxFormSuccessHandler;$.fn.ajaxSubmit=function(options){var $form,callback,data,error_callback,method,url;if(options==null)options={};$form=$(this);$form.clearErrors();if(typeof options==="function")options.success=options;if(options.redirect&&!options.success){options.success=function(){return window.location=options.redirect}}callback=options.success;error_callback=options.error;method=$form.attr("method")||"get";url=$form.attr("action");data=$form.serialize();if(!jQuery.isEmptyObject(options.data)){data=data+"&"+$.param(options.data)}return $.ajax({type:options.type||method,url:options.url||url,data:data,success:function(data){return ajaxFormSuccessHandler($form,data,callback,error_callback)},error:function(){return ajaxFormErrorHandler($form)}})};ajaxFormSuccessHandler=function($form,data,callback,error_callback){if($.isEmptyObject(data&&data.errors)){if(typeof callback==="function"){return callback.call($form[0],data)}else if(data.redirect){return window.location=data.redirect}}else{if(typeof error_callback==="function")error_callback.call($form,data);return $form.applyErrors(data.errors)}};ajaxFormErrorHandler=function(){};return $.fn.ajaxForm=function(options){if(options==null)options={};return $(this).bind("submit",function(event){event.preventDefault();return $(this).ajaxSubmit(options)})}})(jQuery)}).call(this);jQuery(function($){function validateFields(){var cardType=$.payment.cardType($(".cc-number").val());ccNum.toggleClass("invalid",!$.payment.validateCardNumber(ccNum.val()));ccExp.toggleClass("invalid",!$.payment.validateCardExpiry(ccExp.payment("cardExpiryVal")));ccCvc.toggleClass("invalid",!$.payment.validateCardCVC(ccCvc.val(),cardType));name.toggleClass("invalid",name.val().length<3);email.toggleClass("invalid",email.val().length<4);if($("input.invalid").length){needsValidation.addClass("failed");submitButton.addClass("disabled")}else{needsValidation.addClass("passed");submitButton.removeClass("disabled")}}function loadMessages(){function displayMessage(){$(".loading-messages").append("<div>"+messages[i]+"</div>");i++;if(i<2){setTimeout(function(){displayMessage()},2100)}}var messages=["Rummaging through the back room...","Grabbing your album... "],i=0;displayMessage()}var stripeResponseHandler,paymentForm=$(".payment-form"),loadingContainer=$(".loading-container"),loadingSpinner=$(".submit-payment-button"),needsValidation=$(".validation"),submitButton=$(".submit-payment-button"),name=$(".your-name"),email=$(".your-email"),ccNum=$(".cc-number"),ccExp=$(".cc-exp"),ccCvc=$(".cc-cvc");$("[data-numeric]").payment("restrictNumeric");ccNum.payment("formatCardNumber");ccExp.payment("formatCardExpiry");ccCvc.payment("formatCardCVC");paymentForm.keyup(validateFields);$("#payment-form").submit(function(event){var exp_date,expiration_month,expiration_year,$form=$(this);$form.find("button").prop("disabled",true);submitButton.addClass("loading");$(".payment-form").addClass("loading");$(".loading-container").show();loadMessages();event.preventDefault();$("input").removeClass("invalid");$(".validation").removeClass("passed failed");validateFields();exp_date=ccExp.val(),expiration_month=exp_date.split("/")[0].trim(),expiration_year=exp_date.split("/")[1].trim();console.log(exp_date);Stripe.createToken({number:ccNum.val(),cvc:ccCvc.val(),exp_month:expiration_month,exp_year:expiration_year},stripeResponseHandler);$(".payment-form").addClass("loading");return false});stripeResponseHandler=function(status,response){var $form=$("#payment-form");if(response.error){$form.find(".payment-errors").text(response.error.message);$form.find("button").prop("disabled",false)}else{console.log("payment success");var token=response.id;$form.append($('<input type="hidden" name="stripeToken" />').val(token));$form.ajaxSubmit(options={success:function(){paymentForm.removeClass("loading");$(".loading-container").hide();submitButton.hide();var downloadButton='<a class="red-button" href>Download album</a>';$(".modal-footer").append(downloadButton);var html=['<h2 class="bottom1 top1">Thanks for your support!</h2>','<p class="bottom1">Use the download button below to begin downloading the album. Enjoy :-)</p>'].join("\n");paymentForm.html(html)}})}}});jQuery(function(){});Stripe.setPublishableKey("pk_test_iV1NX0AkuxskATxdKxLU26ba");