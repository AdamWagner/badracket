!function(){var a=this;this.Stripe=function(){function a(){}return a.version=2,a.endpoint="https://api.stripe.com/v1",a.validateCardNumber=function(b){return b=(b+"").replace(/\s+|-/g,""),b.length>=10&&b.length<=16&&a.luhnCheck(b)},a.validateCVC=function(b){return b=a.trim(b),/^\d+$/.test(b)&&b.length>=3&&b.length<=4},a.validateExpiry=function(b,c){var d,e;return b=a.trim(b),c=a.trim(c),/^\d+$/.test(b)?/^\d+$/.test(c)?parseInt(b,10)<=12?(e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1:!1:!1},a.cardType=function(b){return a.cardTypes[b.slice(0,2)]||"Unknown"},a.setPublishableKey=function(b){a.key=b},a.createToken=function(b,c,d){var e,f,g;if(null==c&&(c={}),!b)throw"card required";if("object"!=typeof b)throw"card invalid";a.isElement(b)&&(b=a.paramsFromForm(b)),"function"==typeof c?(d=c,c={}):"object"!=typeof c&&(e=parseInt(c,10),c={},e>0&&(c.amount=e));for(f in b)g=b[f],delete b[f],b[a.underscore(f)]=g;return c.card=b,c.key||(c.key=a.key||a.publishableKey),a.validateKey(c.key),a.ajaxJSONP({url:""+a.endpoint+"/tokens",data:c,method:"POST",success:function(a,b){return"function"==typeof d?d(b,a):void 0},complete:a.complete(d),timeout:4e4})},a.getToken=function(b,c){if(!b)throw"token required";return a.validateKey(a.key),a.ajaxJSONP({url:""+a.endpoint+"/tokens/"+b,data:{key:a.key},success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:a.complete(c),timeout:4e4})},a.complete=function(a){return function(b){return"success"!==b?"function"==typeof a?a(500,{error:{code:b,type:b,message:"An unexpected error has occurred. We have been notified of the problem."}}):void 0:void 0}},a.validateKey=function(a){if(!a||"string"!=typeof a)throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(a))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(a))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},a}.call(this),"undefined"!=typeof module&&null!==module&&(module.exports=this.Stripe),"function"==typeof define&&define("stripe",[],function(){return a.Stripe})}.call(this),function(){var a,b,c,d=[].slice;a=encodeURIComponent,b=(new Date).getTime(),c=function(b,d,e){var f,g;null==d&&(d=[]);for(f in b)g=b[f],e&&(f=""+e+"["+f+"]"),"object"==typeof g?c(g,d,f):d.push(""+f+"="+a(g));return d.join("&").replace(/%20/g,"+")},this.Stripe.ajaxJSONP=function(a){var e,f,g,h,i,j;return null==a&&(a={}),g="sjsonp"+ ++b,i=document.createElement("script"),f=null,e=function(){var b;return clearTimeout(f),null!=(b=i.parentNode)&&b.removeChild(i),g in window&&(window[g]=function(){}),"function"==typeof a.complete?a.complete("abort",j,a):void 0},j={abort:e},i.onerror=function(){return j.abort(),"function"==typeof a.error?a.error(j,a):void 0},window[g]=function(){var b;b=1<=arguments.length?d.call(arguments,0):[],clearTimeout(f),i.parentNode.removeChild(i);try{delete window[g]}catch(c){window[g]=void 0}return"function"==typeof a.success&&a.success.apply(a,b),"function"==typeof a.complete?a.complete("success",j,a):void 0},a.data||(a.data={}),a.data.callback=g,a.method&&(a.data._method=a.method),i.src=a.url+"?"+c(a.data),h=document.getElementsByTagName("head")[0],h.appendChild(i),a.timeout>0&&(f=setTimeout(function(){return j.abort(),"function"==typeof a.complete?a.complete("timeout",j,a):void 0},a.timeout)),j}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],h=function(a){return(a+"").replace(/^\s+|\s+$/g,"")},i=function(a){return(a+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},d=function(a){return"object"!=typeof a?!1:"undefined"!=typeof jQuery&&null!==jQuery&&a instanceof jQuery?!0:1===a.nodeType},g=function(b,c){var d,e,f,g,h,j;for(null==c&&(c=!0),"undefined"!=typeof jQuery&&null!==jQuery&&b instanceof jQuery&&(b=b[0]),f=b.getElementsByTagName("input"),g={},h=0,j=f.length;j>h;h++)e=f[h],d=i(e.getAttribute("data-stripe")),(k.call(a,d)>=0||!c)&&(g[d]=e.value);return g},f=function(a){var b,c,d,e,f,g;for(d=!0,e=0,c=(a+"").split("").reverse(),f=0,g=c.length;g>f;f++)b=c[f],b=parseInt(b,10),(d=!d)&&(b*=2),b>9&&(b-=9),e+=b;return 0===e%10},b=function(){var a,b,c,d;for(b={},a=c=40;49>=c;a=++c)b[a]="Visa";for(a=d=50;59>=d;a=++d)b[a]="MasterCard";return b[34]=b[37]="American Express",b[60]=b[62]=b[64]=b[65]="Discover",b[35]="JCB",b[30]=b[36]=b[38]=b[39]="Diners Club",b}(),c={attrs:a,trim:h,underscore:i,isElement:d,paramsFromForm:g,luhnCheck:f,cardTypes:b};for(e in c)j=c[e],this.Stripe[e]=j}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[].slice,u=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=jQuery,a.payment={},a.payment.fn={},a.fn.payment=function(){var b,c;return c=arguments[0],b=2<=arguments.length?t.call(arguments,1):[],a.payment.fn[c].apply(this,b)},e=/(\d{1,4})/g,d=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:e,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:e,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:e,length:[13,14,15,16],cvcLength:[3],luhn:!0}],b=function(a){var b,c,e;for(a=(a+"").replace(/\D/g,""),c=0,e=d.length;e>c;c++)if(b=d[c],b.pattern.test(a))return b},c=function(a){var b,c,e;for(c=0,e=d.length;e>c;c++)if(b=d[c],b.type===a)return b},m=function(a){var b,c,d,e,f,g;for(d=!0,e=0,c=(a+"").split("").reverse(),f=0,g=c.length;g>f;f++)b=c[f],b=parseInt(b,10),(d=!d)&&(b*=2),b>9&&(b-=9),e+=b;return 0===e%10},l=function(a){var b;return null!=a.prop("selectionStart")&&a.prop("selectionStart")!==a.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document?null!=(b=document.selection)?"function"==typeof b.createRange?b.createRange().text:void 0:void 0:void 0)?!0:!1},n=function(b){return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=a.payment.formatCardNumber(d),c.val(d)})},h=function(c){var d,e,f,g,h,i,j;return f=String.fromCharCode(c.which),!/^\d+$/.test(f)||(d=a(c.currentTarget),j=d.val(),e=b(j+f),g=(j.replace(/\D/g,"")+f).length,i=16,e&&(i=e.length[e.length.length-1]),g>=i||null!=d.prop("selectionStart")&&d.prop("selectionStart")!==j.length)?void 0:(h=e&&"amex"===e.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,h.test(j)?(c.preventDefault(),d.val(j+" "+f)):h.test(j+f)?(c.preventDefault(),d.val(j+f+" ")):void 0)},f=function(b){var c,d;return c=a(b.currentTarget),d=c.val(),b.meta||null!=c.prop("selectionStart")&&c.prop("selectionStart")!==d.length?void 0:8===b.which&&/\s\d?$/.test(d)?(b.preventDefault(),c.val(d.replace(/\s\d?$/,""))):void 0},i=function(b){var c,d,e;return d=String.fromCharCode(b.which),/^\d+$/.test(d)?(c=a(b.currentTarget),e=c.val()+d,/^\d$/.test(e)&&"0"!==e&&"1"!==e?(b.preventDefault(),c.val("0"+e+" / ")):/^\d\d$/.test(e)?(b.preventDefault(),c.val(""+e+" / ")):void 0):void 0},j=function(b){var c,d,e;return d=String.fromCharCode(b.which),/^\d+$/.test(d)?(c=a(b.currentTarget),e=c.val(),/^\d\d$/.test(e)?c.val(""+e+" / "):void 0):void 0},k=function(b){var c,d,e;return d=String.fromCharCode(b.which),"/"===d?(c=a(b.currentTarget),e=c.val(),/^\d$/.test(e)&&"0"!==e?c.val("0"+e+" / "):void 0):void 0},g=function(b){var c,d;if(!b.meta&&(c=a(b.currentTarget),d=c.val(),8===b.which&&(null==c.prop("selectionStart")||c.prop("selectionStart")===d.length)))return/\s\/\s?\d?$/.test(d)?(b.preventDefault(),c.val(d.replace(/\s\/\s?\d?$/,""))):void 0},r=function(a){var b;return a.metaKey||a.ctrlKey?!0:32===a.which?!1:0===a.which?!0:a.which<33?!0:(b=String.fromCharCode(a.which),!!/[\d\s]/.test(b))},p=function(c){var d,e,f,g;return d=a(c.currentTarget),f=String.fromCharCode(c.which),/^\d+$/.test(f)&&!l(d)?(g=(d.val()+f).replace(/\D/g,""),e=b(g),e?g.length<=e.length[e.length.length-1]:g.length<=16):void 0},q=function(b){var c,d,e;return c=a(b.currentTarget),d=String.fromCharCode(b.which),/^\d+$/.test(d)&&!l(c)?(e=c.val()+d,e=e.replace(/\D/g,""),e.length>6?!1:void 0):void 0},o=function(b){var c,d,e;return c=a(b.currentTarget),d=String.fromCharCode(b.which),/^\d+$/.test(d)?(e=c.val()+d,e.length<=4):void 0},s=function(b){var c,e,f,g,h;return c=a(b.currentTarget),h=c.val(),g=a.payment.cardType(h)||"unknown",c.hasClass(g)?void 0:(e=function(){var a,b,c;for(c=[],a=0,b=d.length;b>a;a++)f=d[a],c.push(f.type);return c}(),c.removeClass("unknown"),c.removeClass(e.join(" ")),c.addClass(g),c.toggleClass("identified","unknown"!==g),c.trigger("payment.cardType",g))},a.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",o),this},a.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",q),this.on("keypress",i),this.on("keypress",k),this.on("keypress",j),this.on("keydown",g),this},a.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",p),this.on("keypress",h),this.on("keydown",f),this.on("keyup",s),this.on("paste",n),this},a.payment.fn.restrictNumeric=function(){return this.on("keypress",r),this},a.payment.fn.cardExpiryVal=function(){return a.payment.cardExpiryVal(a(this).val())},a.payment.cardExpiryVal=function(a){var b,c,d,e;return a=a.replace(/\s/g,""),e=a.split("/",2),b=e[0],d=e[1],2===(null!=d?d.length:void 0)&&/^\d+$/.test(d)&&(c=(new Date).getFullYear(),c=c.toString().slice(0,2),d=c+d),b=parseInt(b,10),d=parseInt(d,10),{month:b,year:d}},a.payment.validateCardNumber=function(a){var c,d;return a=(a+"").replace(/\s+|-/g,""),/^\d+$/.test(a)?(c=b(a),c?(d=a.length,u.call(c.length,d)>=0&&(c.luhn===!1||m(a))):!1):!1},a.payment.validateCardExpiry=function(b,c){var d,e,f,g;return"object"==typeof b&&"month"in b&&(g=b,b=g.month,c=g.year),b&&c?(b=a.trim(b),c=a.trim(c),/^\d+$/.test(b)?/^\d+$/.test(c)?parseInt(b,10)<=12?(2===c.length&&(f=(new Date).getFullYear(),f=f.toString().slice(0,2),c=f+c),e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1:!1:!1):!1},a.payment.validateCardCVC=function(b,d){var e,f;return b=a.trim(b),/^\d+$/.test(b)?d?(e=b.length,u.call(null!=(f=c(d))?f.cvcLength:void 0,e)>=0):b.length>=3&&b.length<=4:!1},a.payment.cardType=function(a){var c;return a?(null!=(c=b(a))?c.type:void 0)||null:null},a.payment.formatCardNumber=function(a){var c,d,e,f;return(c=b(a))?(e=c.length[c.length.length-1],a=a.replace(/\D/g,""),a=a.slice(0,+e+1||9e9),c.format.global?null!=(f=a.match(c.format))?f.join(" "):void 0:(d=c.format.exec(a),null!=d&&d.shift(),null!=d?d.join(" "):void 0)):a}}.call(this),function(){!function(a){var b,c;return a.errors={attribute:"validate",activationClass:"validation-active",format:"<div class='validation-block'><div class='validation-message'></div></div>",messageClass:"validation-message"},c=function(b,c){var d;if(!b.hasClass(a.errors.activationClass)){if(b.addClass(a.errors.activationClass),d=b.find("."+a.errors.messageClass),0===d.size()&&b.append(a.errors.format),d=b.find("."+a.errors.messageClass),d.size()>0)return d.html(c);throw new Error("configuration error: $.errors.format must have elment with class "+a.errors.messageClass)}},b=function(b,d,e){var f;return f=b.find("["+a.errors.attribute+"~='"+d+"']"),0===f.size()&&(f=a("<div "+a.errors.attribute+"='"+d+"'>"+('Unassigned error: Add validate="'+d+'" attribute somewhere in a form.</div>')),b.prepend(f)),c(f,e)},a.fn.applyErrors=function(b){return a(this).clearErrors(),a(this).addErrors(b)},a.fn.addErrors=function(c){var d,e;return d=a(this),"object"===a.type(c)&&(e=c,c=[],a.each(e,function(b,d){return!d||a.isArray(d)&&0===d.length?void 0:c.push([b,d])})),a(c).each(function(c,e){var f,g;return f=e[0],g=e[1],a.isArray(g)&&(g=g[0]),b(d,f,g)})},a.fn.clearErrors=function(){var b;return b=a(this).find("["+a.errors.attribute+"]"),b.find("."+a.errors.messageClass).html(""),b.removeClass(a.errors.activationClass)}}(jQuery)}.call(this),function(){!function(a){var b,c;return a.fn.ajaxSubmit=function(d){var e,f,g,h,i,j;return null==d&&(d={}),e=a(this),e.clearErrors(),"function"==typeof d&&(d.success=d),d.redirect&&!d.success&&(d.success=function(){return window.location=d.redirect}),f=d.success,h=d.error,i=e.attr("method")||"get",j=e.attr("action"),g=e.serialize(),jQuery.isEmptyObject(d.data)||(g=g+"&"+a.param(d.data)),a.ajax({type:d.type||i,url:d.url||j,data:g,success:function(a){return c(e,a,f,h)},error:function(){return b(e)}})},c=function(b,c,d,e){return a.isEmptyObject(c&&c.errors)?"function"==typeof d?d.call(b[0],c):c.redirect?window.location=c.redirect:void 0:("function"==typeof e&&e.call(b,c),b.applyErrors(c.errors))},b=function(){},a.fn.ajaxForm=function(b){return null==b&&(b={}),a(this).bind("submit",function(c){return c.preventDefault(),a(this).ajaxSubmit(b)})}}(jQuery)}.call(this),jQuery(function(a){function b(a){var b=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return b.test(a)}function c(){var c=a.payment.cardType(o.val());return o.toggleClass("invalid",!a.payment.validateCardNumber(o.val())),p.toggleClass("invalid",!a.payment.validateCardExpiry(p.payment("cardExpiryVal"))),q.toggleClass("invalid",!a.payment.validateCardCVC(q.val(),c)),m.toggleClass("invalid",m.val().length<3),n.toggleClass("invalid",!b(n.val())),a("input.invalid").length?(l.addClass("disabled"),!1):(l.removeClass("disabled"),!0)}function d(){console.log(r),console.log("handle form sumit attached"),h.submit(function(b){if(b.preventDefault(),c()){a(this).find("button").prop("disabled",!0),g.addClass("loading"),i.show(),e();var d=p.val(),f=d.split("/")[0].trim(),h=d.split("/")[1].trim();Stripe.createToken({number:o.val(),cvc:q.val(),exp_month:f,exp_year:h},y)}return!1})}function e(){function b(){a(".loading-messages").append("<div>"+c[d]+"</div>"),d++,2>d&&setTimeout(function(){b()},2100)}var c=["Rummaging through the back room...","Grabbing your album... "],d=0;b()}function f(a,b){console.log("send mail js ran");var c=[a+",","\n","Thanks for supporting "+v+"!","You can download "+u+" with the link below.","\n",w,"\n","-The Bad Racket Team","http://www.badracket.com"].join("\n"),d=u+" Download Link";jQuery.ajax({url:s.domain+"wp-admin/admin-ajax.php",data:{action:"do_ajax",fn:"send_mail",subject:d,message:c,email:b},dataType:"JSON",success:function(a){console.log(a)},error:function(a){console.log(a)}})}var g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,w,x;badracket.setupDownloadForm=function(b,c,d,e,i){function j(e){function i(a){var b=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return b.test(a)&&a.length>0}function j(){return m.toggleClass("invalid",m.val().length<3),n.toggleClass("invalid",!i(n.val())),a("input.invalid").length?(l.addClass("disabled"),!1):(l.removeClass("disabled"),!0)}function k(){l.click(function(){j()&&(l.style("opacity",.5),f(m.val(),n.val()),mixpanel.people.increment("Albums purchased",1),setTimeout(function(){modalFormHTML.modal("hide")},500))})}a("body").append(e),modalFormHTML=a("#buy-album-form"),modalFormHTML.modal("show"),a(".buy-album-cover").attr("src",b),a("#buy-album-header").text(c),a(".buy-artist-name").text(d),a(".price").text("Free"),modalFormHTML.on("hidden",function(){this.remove()}),g=a(".payment-form-wrapper"),m=a(".your-name"),n=a(".your-email"),l=a(".submit-payment-button"),h=a("#payment-form"),l.attr("href",r),m.toggleClass("invalid",m.val().length<3),n.toggleClass("invalid",!i(n.val())),j(),g.keyup(j),k()}a("#buy-album-form").remove(),t=b,u=c,v=d,w=i,x=e,r=i,jQuery.ajax({url:s.domain+"wp-admin/admin-ajax.php",data:{action:"do_ajax",fn:"download_modal"},dataType:"JSON",success:function(a){j(a)},error:function(){console.log("there has been an error")}})},badracket.setupPayForm=function(b,e,f,y,z){function A(r){a("body").append(r),modalFormHTML=a("#buy-album-form"),modalFormHTML.modal("show"),modalFormHTML.on("hidden",function(){this.remove()}),g=a(".payment-form-wrapper"),h=a("#payment-form"),i=a(".loading-container"),j=a(".submit-payment-button"),k=a(".validation"),l=a(".submit-payment-button"),m=a(".your-name"),n=a(".your-email"),o=a(".cc-number"),p=a(".cc-exp"),q=a(".cc-cvc"),h.append('<input type="hidden" name="price" value="'+B+'"/">'),a(".buy-album-cover").attr("src",b),a("#buy-album-header").text(e),a(".buy-artist-name").text(f),a(".price").text(y),a("[data-numeric]").payment("restrictNumeric"),o.payment("formatCardNumber"),p.payment("formatCardExpiry"),q.payment("formatCardCVC"),c(),g.keyup(c),d()}t=b,u=e,v=f,w=z,x=y;var B=100*parseInt(x.substring(1),10);r=z,console.log(B),jQuery.ajax({url:s.domain+"wp-admin/admin-ajax.php",data:{action:"do_ajax",fn:"get_payment_modal"},dataType:"JSON",success:function(a){A(a)},error:function(){console.log("there has been an error")}})};var y=function(b,c){if(console.log(b),console.log(c),c.error)h.find(".payment-errors").text(c.error.message),h.find("button").prop("disabled",!1);else{console.log("payment success yea");var d=c.id;h.append(a('<input type="hidden" name="stripeToken" />').val(d)),h.ajaxSubmit(options={success:function(){g.removeClass("loading"),i.hide(),l.hide(),f(m.val(),n.val()),mixpanel.people.increment("Albums purchased",1),mixpanel.people.track_charge(parseInt(x.substring(1),10));var b='<a class="red-button" href="'+r+'">Download album</a>';a(".modal-footer").append(b);var c=['<h2 class="bottom1 top1">Thanks for your support!</h2>','<p class="bottom1">Use the download button below to begin downloading the album. Enjoy :-)</p>'].join("\n");g.html(c)}})}}});var stripe_pk="local"===BR_ENV?"pk_test_iV1NX0AkuxskATxdKxLU26ba":"pk_live_ef75VL0GrurD3Fkv7qq4lkHl";Stripe.setPublishableKey(stripe_pk);