jQuery(function(a){function b(a){var b=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return b.test(a)}function c(){var c=a.payment.cardType(o.val());return o.toggleClass("invalid",!a.payment.validateCardNumber(o.val())),p.toggleClass("invalid",!a.payment.validateCardExpiry(p.payment("cardExpiryVal"))),q.toggleClass("invalid",!a.payment.validateCardCVC(q.val(),c)),m.toggleClass("invalid",m.val().length<3),n.toggleClass("invalid",!b(n.val())),a("input.invalid").length?(l.addClass("disabled"),!1):(l.removeClass("disabled"),!0)}function d(){console.log(r),console.log("handle form sumit attached"),h.submit(function(b){if(b.preventDefault(),c()){a(this).find("button").prop("disabled",!0),g.addClass("loading"),i.show(),e();var d=p.val(),f=d.split("/")[0].trim(),h=d.split("/")[1].trim();Stripe.createToken({number:o.val(),cvc:q.val(),exp_month:f,exp_year:h},y)}return!1})}function e(){function b(){a(".loading-messages").append("<div>"+c[d]+"</div>"),d++,2>d&&setTimeout(function(){b()},2100)}var c=["Rummaging through the back room...","Grabbing your album... "],d=0;b()}function f(a,b){console.log("send mail js ran");var c=[a+",","\n","Thanks for supporting "+v+"!","You can download "+u+" with the link below.","\n",w,"\n","-The Bad Racket Team","http://www.badracket.com"].join("\n"),d=u+" Download Link";jQuery.ajax({url:s.domain+"wp-admin/admin-ajax.php",data:{action:"do_ajax",fn:"send_mail",subject:d,message:c,email:b},dataType:"JSON",success:function(a){console.log(a)},error:function(a){console.log(a)}})}var g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,w,x;badracket.setupDownloadForm=function(b,c,d,e,i){function j(e){function i(a){var b=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return b.test(a)&&a.length>0}function j(){return m.toggleClass("invalid",m.val().length<3),n.toggleClass("invalid",!i(n.val())),a("input.invalid").length?(l.addClass("disabled"),!1):(l.removeClass("disabled"),!0)}function k(){l.click(function(){j()&&(l.style("opacity",.5),f(m.val(),n.val()),mixpanel.people.increment("Albums purchased",1),setTimeout(function(){modalFormHTML.modal("hide")},500))})}a("body").append(e),modalFormHTML=a("#buy-album-form"),modalFormHTML.modal("show"),a(".buy-album-cover").attr("src",b),a("#buy-album-header").text(c),a(".buy-artist-name").text(d),a(".price").text("Free"),modalFormHTML.on("hidden",function(){this.remove()}),g=a(".payment-form-wrapper"),m=a(".your-name"),n=a(".your-email"),l=a(".submit-payment-button"),h=a("#payment-form"),l.attr("href",r),m.toggleClass("invalid",m.val().length<3),n.toggleClass("invalid",!i(n.val())),j(),g.keyup(j),k()}a("#buy-album-form").remove(),t=b,u=c,v=d,w=i,x=e,r=i,jQuery.ajax({url:s.domain+"wp-admin/admin-ajax.php",data:{action:"do_ajax",fn:"download_modal"},dataType:"JSON",success:function(a){j(a)},error:function(){console.log("there has been an error")}})},badracket.setupPayForm=function(b,e,f,y,z){function A(r){a("body").append(r),modalFormHTML=a("#buy-album-form"),modalFormHTML.modal("show"),modalFormHTML.on("hidden",function(){this.remove()}),g=a(".payment-form-wrapper"),h=a("#payment-form"),i=a(".loading-container"),j=a(".submit-payment-button"),k=a(".validation"),l=a(".submit-payment-button"),m=a(".your-name"),n=a(".your-email"),o=a(".cc-number"),p=a(".cc-exp"),q=a(".cc-cvc"),h.append('<input type="hidden" name="price" value="'+B+'"/">'),a(".buy-album-cover").attr("src",b),a("#buy-album-header").text(e),a(".buy-artist-name").text(f),a(".price").text(y),a("[data-numeric]").payment("restrictNumeric"),o.payment("formatCardNumber"),p.payment("formatCardExpiry"),q.payment("formatCardCVC"),c(),g.keyup(c),d()}t=b,u=e,v=f,w=z,x=y;var B=100*parseInt(x.substring(1),10);r=z,console.log(B),jQuery.ajax({url:s.domain+"wp-admin/admin-ajax.php",data:{action:"do_ajax",fn:"get_payment_modal"},dataType:"JSON",success:function(a){A(a)},error:function(){console.log("there has been an error")}})};var y=function(b,c){if(console.log(b),console.log(c),c.error)h.find(".payment-errors").text(c.error.message),h.find("button").prop("disabled",!1);else{console.log("payment success yea");var d=c.id;h.append(a('<input type="hidden" name="stripeToken" />').val(d)),h.ajaxSubmit(options={success:function(){g.removeClass("loading"),i.hide(),l.hide(),f(m.val(),n.val()),mixpanel.people.increment("Albums purchased",1),mixpanel.people.track_charge(parseInt(x.substring(1),10));var b='<a class="red-button" href="'+r+'">Download album</a>';a(".modal-footer").append(b);var c=['<h2 class="bottom1 top1">Thanks for your support!</h2>','<p class="bottom1">Use the download button below to begin downloading the album. Enjoy :-)</p>'].join("\n");g.html(c)}})}}});var stripe_pk="local"===BR_ENV?"pk_test_iV1NX0AkuxskATxdKxLU26ba":"pk_live_ef75VL0GrurD3Fkv7qq4lkHl";Stripe.setPublishableKey(stripe_pk);